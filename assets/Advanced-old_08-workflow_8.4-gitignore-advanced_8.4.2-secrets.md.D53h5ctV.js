import{_ as a,c as i,o as n,a3 as e}from"./chunks/framework.CUcrqFol.js";const o=JSON.parse('{"title":"8.4.2 密码千万别提交——敏感文件：.env* 忽略；用 .env.example 传达配置","description":"8.4.2 密码千万别提交——敏感文件管理 一旦密钥进了 Git 历史，即使删除也还在——所以第一步就要拦住。 敏感信息类型 | 类型 | 示例 | 风险 | |------|------|------| | 数据库密码 | DATABASE_URL | 数据泄露 | | API 密钥 | OPENAI_API_KEY","frontmatter":{"title":"8.4.2 密码千万别提交——敏感文件：`.env*` 忽略；用 `.env.example` 传达配置","typora-root-url":"../../public"},"headers":[],"relativePath":"Advanced-old/08-workflow/8.4-gitignore-advanced/8.4.2-secrets.md","filePath":"Advanced-old/08-workflow/8.4-gitignore-advanced/8.4.2-secrets.md","lastUpdated":1766168364000}'),t={name:"Advanced-old/08-workflow/8.4-gitignore-advanced/8.4.2-secrets.md"};function l(p,s,h,d,k,r){return n(),i("div",null,[...s[0]||(s[0]=[e(`<h1 id="_8-4-2-密码千万别提交——敏感文件管理" tabindex="-1">8.4.2 密码千万别提交——敏感文件管理 <a class="header-anchor" href="#_8-4-2-密码千万别提交——敏感文件管理" aria-label="Permalink to &quot;8.4.2 密码千万别提交——敏感文件管理&quot;">​</a></h1><p>一旦密钥进了 Git 历史，即使删除也还在——所以第一步就要拦住。</p><h2 id="敏感信息类型" tabindex="-1">敏感信息类型 <a class="header-anchor" href="#敏感信息类型" aria-label="Permalink to &quot;敏感信息类型&quot;">​</a></h2><table tabindex="0"><thead><tr><th>类型</th><th>示例</th><th>风险</th></tr></thead><tbody><tr><td>数据库密码</td><td>DATABASE_URL</td><td>数据泄露</td></tr><tr><td>API 密钥</td><td>OPENAI_API_KEY</td><td>费用损失</td></tr><tr><td>认证密钥</td><td>JWT_SECRET</td><td>身份伪造</td></tr><tr><td>云服务凭证</td><td>AWS_SECRET_KEY</td><td>资源被盗用</td></tr><tr><td>私钥证书</td><td>*.pem, *.key</td><td>安全漏洞</td></tr></tbody></table><h2 id="env-文件忽略策略" tabindex="-1">.env 文件忽略策略 <a class="header-anchor" href="#env-文件忽略策略" aria-label="Permalink to &quot;.env 文件忽略策略&quot;">​</a></h2><h3 id="基本配置" tabindex="-1">基本配置 <a class="header-anchor" href="#基本配置" aria-label="Permalink to &quot;基本配置&quot;">​</a></h3><div class="language-gitignore vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">gitignore</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 忽略所有环境变量文件</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.env</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.env.local</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.env.development.local</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.env.test.local</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.env.production.local</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 但保留示例文件</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">!.env.example</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">!.env.template</span></span></code></pre></div><h3 id="next-js-环境变量规则" tabindex="-1">Next.js 环境变量规则 <a class="header-anchor" href="#next-js-环境变量规则" aria-label="Permalink to &quot;Next.js 环境变量规则&quot;">​</a></h3><div class="language-gitignore vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">gitignore</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 本地环境变量（不提交）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.env.local</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.env.*.local</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 通用环境变量（按需提交）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># .env              # 可能包含默认非敏感值</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># .env.development  # 开发环境默认值</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># .env.production   # 生产环境默认值</span></span></code></pre></div><h2 id="env-example-模板" tabindex="-1">.env.example 模板 <a class="header-anchor" href="#env-example-模板" aria-label="Permalink to &quot;.env.example 模板&quot;">​</a></h2><p>创建 <code>.env.example</code> 告诉队友需要哪些配置：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 数据库</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DATABASE_URL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">postgresql://user:password@localhost:5432/mydb</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 认证</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NEXTAUTH_SECRET</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">your-secret-here</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NEXTAUTH_URL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http://localhost:3000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 第三方服务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">OPENAI_API_KEY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">sk-xxx</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">STRIPE_SECRET_KEY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">sk_test_xxx</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 可选配置</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># REDIS_URL=redis://localhost:6379</span></span></code></pre></div><p><strong>原则</strong>：</p><ul><li>保留变量名和格式</li><li>用占位符替代真实值</li><li>添加简要注释说明用途</li></ul><h2 id="私钥与证书" tabindex="-1">私钥与证书 <a class="header-anchor" href="#私钥与证书" aria-label="Permalink to &quot;私钥与证书&quot;">​</a></h2><div class="language-gitignore vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">gitignore</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># SSL/TLS 证书</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">*.pem</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">*.key</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">*.crt</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">*.p12</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">*.pfx</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># SSH 密钥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id_rsa</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id_ed25519</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">*.pub  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 公钥可能也要保护</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># GPG 密钥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">*.gpg</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">*.asc</span></span></code></pre></div><h2 id="firebase-和云服务" tabindex="-1">Firebase 和云服务 <a class="header-anchor" href="#firebase-和云服务" aria-label="Permalink to &quot;Firebase 和云服务&quot;">​</a></h2><div class="language-gitignore vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">gitignore</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Firebase</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">firebase-adminsdk-*.json</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">*-firebase-adminsdk-*.json</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">firebase-config.json</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Google Cloud</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">service-account.json</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">*-credentials.json</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># AWS</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.aws/credentials</span></span></code></pre></div><h2 id="意外提交怎么办" tabindex="-1">意外提交怎么办 <a class="header-anchor" href="#意外提交怎么办" aria-label="Permalink to &quot;意外提交怎么办&quot;">​</a></h2><h3 id="情况-1-还没推送" tabindex="-1">情况 1：还没推送 <a class="header-anchor" href="#情况-1-还没推送" aria-label="Permalink to &quot;情况 1：还没推送&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. 从暂存区移除</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cached</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .env</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. 添加到 .gitignore</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;.env&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .gitignore</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. 修改上一次提交</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> commit</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --amend</span></span></code></pre></div><h3 id="情况-2-已经推送" tabindex="-1">情况 2：已经推送 <a class="header-anchor" href="#情况-2-已经推送" aria-label="Permalink to &quot;情况 2：已经推送&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. 立即更换所有泄露的密钥！</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. 使用 git-filter-repo 清理历史（推荐）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git-filter-repo</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> filter-repo</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --path</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .env</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --invert-paths</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. 强制推送</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --force-with-lease</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 4. 通知团队重新 clone</span></span></code></pre></div><blockquote><p><strong>重要</strong>：即使从历史中删除，也必须更换密钥！因为可能已被他人拉取。</p></blockquote><h3 id="使用-github-secret-scanning" tabindex="-1">使用 GitHub Secret Scanning <a class="header-anchor" href="#使用-github-secret-scanning" aria-label="Permalink to &quot;使用 GitHub Secret Scanning&quot;">​</a></h3><p>GitHub 会自动扫描常见的密钥格式并发出警告：</p><ul><li>AWS 访问密钥</li><li>Google API 密钥</li><li>OpenAI API 密钥</li><li>Stripe 密钥</li><li>等等</li></ul><h2 id="环境变量管理工具" tabindex="-1">环境变量管理工具 <a class="header-anchor" href="#环境变量管理工具" aria-label="Permalink to &quot;环境变量管理工具&quot;">​</a></h2><table tabindex="0"><thead><tr><th>工具</th><th>特点</th><th>适用场景</th></tr></thead><tbody><tr><td>Vercel 环境变量</td><td>与部署集成</td><td>Vercel 部署项目</td></tr><tr><td>GitHub Secrets</td><td>CI/CD 使用</td><td>GitHub Actions</td></tr><tr><td>Doppler</td><td>团队级管理</td><td>多环境多项目</td></tr><tr><td>1Password</td><td>密码管理器</td><td>个人开发者</td></tr></tbody></table><h2 id="ai-协作注意事项" tabindex="-1">AI 协作注意事项 <a class="header-anchor" href="#ai-协作注意事项" aria-label="Permalink to &quot;AI 协作注意事项&quot;">​</a></h2><p>当向 AI 提问时：</p><p><strong>不要</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>我的 DATABASE_URL 是 postgresql://admin:MyP@ssw0rd@db.example.com:5432/prod</span></span>
<span class="line"><span>为什么连不上？</span></span></code></pre></div><p><strong>应该</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>我的 DATABASE_URL 格式是 postgresql://user:password@host:5432/database</span></span>
<span class="line"><span>连接时报错 &quot;connection refused&quot;，可能是什么原因？</span></span></code></pre></div><h2 id="验收清单" tabindex="-1">验收清单 <a class="header-anchor" href="#验收清单" aria-label="Permalink to &quot;验收清单&quot;">​</a></h2><ul><li>[ ] 配置了 .env* 的忽略规则</li><li>[ ] 创建了 .env.example 模板</li><li>[ ] 理解私钥证书的忽略方式</li><li>[ ] 知道意外提交后的处理流程</li></ul>`,37)])])}const g=a(t,[["render",l]]);export{o as __pageData,g as default};
