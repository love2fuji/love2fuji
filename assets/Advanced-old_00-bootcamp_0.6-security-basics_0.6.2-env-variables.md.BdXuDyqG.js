import{_ as e,C as h,c as t,o as i,a3 as a,b as k,w as n,a as p,G as r,a4 as d}from"./chunks/framework.CUcrqFol.js";const v=JSON.parse('{"title":"0.6.2 你的密码放对地方了吗——环境变量与密钥管理：安全存储的最佳实践","description":"0.6.2 你的密码放对地方了吗——环境变量与密钥管理：安全存储的最佳实践 一句话破题 密钥不进代码库，不进日志。**环境变量 + 密钥管理服务 + 轮换机制**，是基础中的基础。 .env 文件层级 ：本地私有，开发者机器的机密配置；不提交版本库。 ：团队共享的开发环境变量（不含密钥）。 ：生产环境变量（不含明文密钥","frontmatter":{"title":"0.6.2 你的密码放对地方了吗——环境变量与密钥管理：安全存储的最佳实践","typora-root-url":"../../public"},"headers":[],"relativePath":"Advanced-old/00-bootcamp/0.6-security-basics/0.6.2-env-variables.md","filePath":"Advanced-old/00-bootcamp/0.6-security-basics/0.6.2-env-variables.md","lastUpdated":1766168364000}'),E={name:"Advanced-old/00-bootcamp/0.6-security-basics/0.6.2-env-variables.md"};function o(g,s,c,y,F,A){const l=h("Mermaid");return i(),t("div",null,[s[1]||(s[1]=a('<h1 id="_0-6-2-你的密码放对地方了吗——环境变量与密钥管理-安全存储的最佳实践" tabindex="-1">0.6.2 你的密码放对地方了吗——环境变量与密钥管理：安全存储的最佳实践 <a class="header-anchor" href="#_0-6-2-你的密码放对地方了吗——环境变量与密钥管理-安全存储的最佳实践" aria-label="Permalink to &quot;0.6.2 你的密码放对地方了吗——环境变量与密钥管理：安全存储的最佳实践&quot;">​</a></h1><h2 id="一句话破题" tabindex="-1">一句话破题 <a class="header-anchor" href="#一句话破题" aria-label="Permalink to &quot;一句话破题&quot;">​</a></h2><p>密钥不进代码库，不进日志。<strong>环境变量 + 密钥管理服务 + 轮换机制</strong>，是基础中的基础。</p><h2 id="env-文件层级" tabindex="-1">.env 文件层级 <a class="header-anchor" href="#env-文件层级" aria-label="Permalink to &quot;.env 文件层级&quot;">​</a></h2><ul><li><code>.env.local</code>：本地私有，开发者机器的机密配置；不提交版本库。</li><li><code>.env.development</code>：团队共享的开发环境变量（不含密钥）。</li><li><code>.env.production</code>：生产环境变量（不含明文密钥）；密钥由密钥管理服务注入。</li></ul>',5)),(i(),k(d,null,{default:n(()=>[r(l,{id:"mermaid-29",class:"mermaid",graph:"flowchart%20LR%0A%20%20%20%20subgraph%20sgenv%20%5B%22%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%B1%82%E7%BA%A7%22%5D%0A%20%20%20%20%20%20%20%20LocalEnv%5B.env.local(%E7%A7%81%E6%9C%89)%5D%20--%3E%20DevEnv%5B.env.development(%E5%85%B1%E4%BA%AB)%5D%3B%0A%20%20%20%20%20%20%20%20DevEnv%20--%3E%20ProdEnv%5B.env.production(%E7%94%9F%E4%BA%A7)%5D%3B%0A%20%20%20%20%20%20%20%20ProdEnv%20--%3E%20SecretMgr%5B%E5%AF%86%E9%92%A5%E7%AE%A1%E7%90%86%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%85%A5%5D%3B%0A%20%20%20%20end%0A"})]),fallback:n(()=>[...s[0]||(s[0]=[p(" Loading... ",-1)])]),_:1})),s[2]||(s[2]=a(`<h2 id="密钥管理与-gitignore" tabindex="-1">密钥管理与 .gitignore <a class="header-anchor" href="#密钥管理与-gitignore" aria-label="Permalink to &quot;密钥管理与 .gitignore&quot;">​</a></h2><ul><li><code>.gitignore</code> 示例：</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>.env*</span></span>
<span class="line"><span>.env.local</span></span>
<span class="line"><span>.env.production.local</span></span></code></pre></div><ul><li>禁止将 API Key、数据库连接串等明文放入代码或日志。</li><li>生产环境使用云密钥服务：AWS Secrets Manager、Azure Key Vault、GCP Secret Manager。</li></ul><h2 id="windows-powershell-操作" tabindex="-1">Windows PowerShell 操作 <a class="header-anchor" href="#windows-powershell-操作" aria-label="Permalink to &quot;Windows PowerShell 操作&quot;">​</a></h2><ul><li>查看：<code>Get-ChildItem Env:</code></li><li>会话设置：<code>$env:DB_URL = &#39;postgres://user:pass@host:5432/db&#39;</code></li><li>持久化：<code>setx DB_URL &quot;postgres://user:pass@host:5432/db&quot;</code></li></ul><h2 id="typescript-安全读取示例" tabindex="-1">TypeScript 安全读取示例 <a class="header-anchor" href="#typescript-安全读取示例" aria-label="Permalink to &quot;TypeScript 安全读取示例&quot;">​</a></h2><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> EnvVars</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  NODE_ENV</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;development&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;production&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;test&#39;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  API_BASE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  DB_URL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> required</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ReadonlyArray</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">keyof</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> EnvVars</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;NODE_ENV&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;API_BASE&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;DB_URL&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> readEnv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> EnvVars</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> missing</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> env</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> process.env</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  required.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">k</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">env[k]) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      missing.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(k)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (missing.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Missing env: &#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> missing.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;,&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    NODE_ENV: env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NODE_ENV</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> EnvVars</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;NODE_ENV&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    API_BASE: env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API_BASE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    DB_URL: env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">DB_URL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> cfg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> readEnv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre></div><h2 id="密钥轮换" tabindex="-1">密钥轮换 <a class="header-anchor" href="#密钥轮换" aria-label="Permalink to &quot;密钥轮换&quot;">​</a></h2><ul><li>定期更新：每季度轮换关键密钥；高风险密钥更频繁。</li><li>版本管理：密钥以标签标识版本，旧版本短时间保留以支持平滑切换。</li><li>自动化：CI/CD 在部署前拉取最新密钥；发布后验证连接可用。</li></ul><h2 id="生产环境密钥-云服务商的密钥管理" tabindex="-1">生产环境密钥：云服务商的密钥管理 <a class="header-anchor" href="#生产环境密钥-云服务商的密钥管理" aria-label="Permalink to &quot;生产环境密钥：云服务商的密钥管理&quot;">​</a></h2><ul><li>在云侧创建密钥，配置访问策略（最小权限），仅允许特定服务读取。</li><li>应用启动时动态注入密钥，避免在镜像与代码中存储明文。</li><li>审计与告警：读取事件记录在案；异常访问触发告警。</li></ul><h2 id="ai-协作指南" tabindex="-1">AI 协作指南 <a class="header-anchor" href="#ai-协作指南" aria-label="Permalink to &quot;AI 协作指南&quot;">​</a></h2><ul><li>核心意图：让 AI 生成<strong>环境变量规范</strong>与<strong>轮换流程</strong>，并输出 PowerShell 命令。</li><li>需求定义公式： <ul><li>“为生产环境设计环境变量与密钥注入流程，包含 <code>.gitignore</code> 规则与轮换策略，输出 PowerShell 命令。”</li></ul></li><li>关键术语：<code>env</code>, <code>Secrets Manager</code>, <code>Key Vault</code>, <code>轮换</code>, <code>最小权限</code>。</li></ul><h2 id="避坑指南" tabindex="-1">避坑指南 <a class="header-anchor" href="#避坑指南" aria-label="Permalink to &quot;避坑指南&quot;">​</a></h2><ul><li>不要把密钥放到 <code>.env.development</code> 或任何共享文件；只在 <code>.env.local</code> 或云密钥服务中保存。</li><li>不要在日志中打印 <code>process.env</code>；必要信息做遮罩处理。</li></ul>`,16))])}const B=e(E,[["render",o]]);export{v as __pageData,B as default};
