import{_ as p,C as l,c as h,o as i,a3 as a,b as e,w as n,a as k,G as r,a4 as E}from"./chunks/framework.CUcrqFol.js";const D=JSON.parse('{"title":"2.5 代码为什么会越写越乱——架构分层详解：页面/路由、API/HTTP、服务层/业务、数据层/Prisma+SQL","description":"2.5 代码为什么会越写越乱——架构分层 认知重构 代码越写越乱的根本原因是：**职责混杂**。页面组件里写数据库查询，API 路由里写业务逻辑，到处都是重复代码。分层架构的目的就是**让每一层只做一件事**。 分层架构全景 各层职责速览 | 层级 | 职责 | 关键文件 | |------|------|------","frontmatter":{"title":"2.5 代码为什么会越写越乱——架构分层详解：页面/路由、API/HTTP、服务层/业务、数据层/Prisma+SQL","typora-root-url":"../../public"},"headers":[],"relativePath":"Advanced-old/02-tech-stack/2.5-architecture-layers/index.md","filePath":"Advanced-old/02-tech-stack/2.5-architecture-layers/index.md","lastUpdated":1766168364000}'),d={name:"Advanced-old/02-tech-stack/2.5-architecture-layers/index.md"};function g(o,s,y,c,F,A){const t=l("Mermaid");return i(),h("div",null,[s[1]||(s[1]=a(`<h1 id="_2-5-代码为什么会越写越乱——架构分层" tabindex="-1">2.5 代码为什么会越写越乱——架构分层 <a class="header-anchor" href="#_2-5-代码为什么会越写越乱——架构分层" aria-label="Permalink to &quot;2.5 代码为什么会越写越乱——架构分层&quot;">​</a></h1><h2 id="认知重构" tabindex="-1">认知重构 <a class="header-anchor" href="#认知重构" aria-label="Permalink to &quot;认知重构&quot;">​</a></h2><p>代码越写越乱的根本原因是：<strong>职责混杂</strong>。页面组件里写数据库查询，API 路由里写业务逻辑，到处都是重复代码。分层架构的目的就是<strong>让每一层只做一件事</strong>。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>乱的代码：page.tsx 里既有 UI、又有业务逻辑、还有数据库操作</span></span>
<span class="line"><span>好的代码：page.tsx 只管 UI，逻辑交给 service，数据交给 repository</span></span></code></pre></div><h2 id="分层架构全景" tabindex="-1">分层架构全景 <a class="header-anchor" href="#分层架构全景" aria-label="Permalink to &quot;分层架构全景&quot;">​</a></h2>`,5)),(i(),e(E,null,{default:n(()=>[r(t,{id:"mermaid-13",class:"mermaid",graph:"flowchart%20TB%0A%20%20%20%20subgraph%20Presentation%5B%22%E8%A1%A8%E7%8E%B0%E5%B1%82%20Presentation%22%5D%0A%20%20%20%20%20%20%20%20Page%5B%22page.tsx%22%5D%0A%20%20%20%20%20%20%20%20Layout%5B%22layout.tsx%22%5D%0A%20%20%20%20%20%20%20%20Component%5B%22components%2F*%22%5D%0A%20%20%20%20end%0A%20%20%20%20%0A%20%20%20%20subgraph%20Interface%5B%22%E6%8E%A5%E5%8F%A3%E5%B1%82%20Interface%22%5D%0A%20%20%20%20%20%20%20%20API%5B%22API%20Routes%22%5D%0A%20%20%20%20%20%20%20%20SA%5B%22Server%20Actions%22%5D%0A%20%20%20%20end%0A%20%20%20%20%0A%20%20%20%20subgraph%20Service%5B%22%E4%B8%9A%E5%8A%A1%E5%B1%82%20Service%22%5D%0A%20%20%20%20%20%20%20%20UserService%5B%22user.service.ts%22%5D%0A%20%20%20%20%20%20%20%20PostService%5B%22post.service.ts%22%5D%0A%20%20%20%20end%0A%20%20%20%20%0A%20%20%20%20subgraph%20Data%5B%22%E6%95%B0%E6%8D%AE%E5%B1%82%20Data%22%5D%0A%20%20%20%20%20%20%20%20Prisma%5B%22Prisma%20Client%22%5D%0A%20%20%20%20%20%20%20%20Repository%5B%22repositories%2F*%22%5D%0A%20%20%20%20end%0A%20%20%20%20%0A%20%20%20%20subgraph%20DB%5B%22%E6%95%B0%E6%8D%AE%E5%BA%93%22%5D%0A%20%20%20%20%20%20%20%20PostgreSQL%5B%22PostgreSQL%22%5D%0A%20%20%20%20end%0A%20%20%20%20%0A%20%20%20%20Page%20--%3E%20SA%0A%20%20%20%20Page%20--%3E%20API%0A%20%20%20%20API%20--%3E%20Service%0A%20%20%20%20SA%20--%3E%20Service%0A%20%20%20%20Service%20--%3E%20Repository%0A%20%20%20%20Repository%20--%3E%20Prisma%0A%20%20%20%20Prisma%20--%3E%20PostgreSQL%0A"})]),fallback:n(()=>[...s[0]||(s[0]=[k(" Loading... ",-1)])]),_:1})),s[2]||(s[2]=a(`<h2 id="各层职责速览" tabindex="-1">各层职责速览 <a class="header-anchor" href="#各层职责速览" aria-label="Permalink to &quot;各层职责速览&quot;">​</a></h2><table tabindex="0"><thead><tr><th>层级</th><th>职责</th><th>关键文件</th></tr></thead><tbody><tr><td><strong>表现层</strong></td><td>UI 渲染、用户交互</td><td><code>page.tsx</code>, <code>components/*</code></td></tr><tr><td><strong>接口层</strong></td><td>请求处理、参数校验</td><td><code>route.ts</code>, <code>actions.ts</code></td></tr><tr><td><strong>业务层</strong></td><td>核心逻辑、业务规则</td><td><code>*.service.ts</code></td></tr><tr><td><strong>数据层</strong></td><td>数据访问、ORM 操作</td><td><code>*.repository.ts</code>, Prisma</td></tr></tbody></table><h2 id="为什么要分层" tabindex="-1">为什么要分层？ <a class="header-anchor" href="#为什么要分层" aria-label="Permalink to &quot;为什么要分层？&quot;">​</a></h2><h3 id="不分层的代码" tabindex="-1">不分层的代码 <a class="header-anchor" href="#不分层的代码" aria-label="Permalink to &quot;不分层的代码&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// app/posts/page.tsx - 一个文件干所有事</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PostsPage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // UI 关心的</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> session</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getServerSession</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 业务逻辑</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">session) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    redirect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/login&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 数据访问</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> posts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> prisma.post.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">findMany</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    where: { authorId: session.user.id },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    orderBy: { createdAt: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;desc&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    include: { author: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, tags: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 更多业务逻辑</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> publishedPosts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> posts.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">p</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> p.status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;published&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> draftPosts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> posts.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">p</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> p.status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;draft&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">h1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;我的文章</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">h1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      {</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* 很长的 JSX */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">div</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>问题</strong>：</p><ul><li>换数据库要改页面文件</li><li>业务逻辑无法复用</li><li>难以测试</li><li>AI 生成的代码到处都是</li></ul><h3 id="分层后的代码" tabindex="-1">分层后的代码 <a class="header-anchor" href="#分层后的代码" aria-label="Permalink to &quot;分层后的代码&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// app/posts/page.tsx - 只关心 UI</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PostsPage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">publishedPosts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">draftPosts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> postService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMyPosts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      &lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PostTabs published</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{publishedPosts} drafts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{draftPosts} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">div</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// services/post.service.ts - 只关心业务逻辑</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> postService</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getMyPosts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> session</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> authService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">requireAuth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> posts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> postRepository.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">findByAuthor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(session.user.id)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      publishedPosts: posts.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">p</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> p.status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;published&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      draftPosts: posts.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">p</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> p.status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;draft&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// repositories/post.repository.ts - 只关心数据访问</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> postRepository</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> findByAuthor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">authorId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> prisma.post.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">findMany</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      where: { authorId },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      orderBy: { createdAt: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;desc&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      include: { author: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, tags: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>好处</strong>：</p><ul><li>每层职责单一，易于理解</li><li>业务逻辑可复用</li><li>易于测试（Mock 数据层即可）</li><li>AI 生成的代码有固定的放置位置</li></ul><h2 id="目录结构建议" tabindex="-1">目录结构建议 <a class="header-anchor" href="#目录结构建议" aria-label="Permalink to &quot;目录结构建议&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>src/</span></span>
<span class="line"><span>├── app/                    # 表现层 + 接口层</span></span>
<span class="line"><span>│   ├── (marketing)/        # 营销页面</span></span>
<span class="line"><span>│   ├── (dashboard)/        # 后台页面</span></span>
<span class="line"><span>│   ├── api/                # API Routes</span></span>
<span class="line"><span>│   └── actions/            # Server Actions（可选单独放）</span></span>
<span class="line"><span>│</span></span>
<span class="line"><span>├── components/             # UI 组件</span></span>
<span class="line"><span>│   ├── ui/                 # 基础 UI 组件</span></span>
<span class="line"><span>│   └── features/           # 业务组件</span></span>
<span class="line"><span>│</span></span>
<span class="line"><span>├── services/               # 业务层</span></span>
<span class="line"><span>│   ├── auth.service.ts</span></span>
<span class="line"><span>│   ├── user.service.ts</span></span>
<span class="line"><span>│   └── post.service.ts</span></span>
<span class="line"><span>│</span></span>
<span class="line"><span>├── repositories/           # 数据层</span></span>
<span class="line"><span>│   ├── user.repository.ts</span></span>
<span class="line"><span>│   └── post.repository.ts</span></span>
<span class="line"><span>│</span></span>
<span class="line"><span>├── lib/                    # 工具函数</span></span>
<span class="line"><span>│   ├── prisma.ts</span></span>
<span class="line"><span>│   └── utils.ts</span></span>
<span class="line"><span>│</span></span>
<span class="line"><span>└── types/                  # 类型定义</span></span>
<span class="line"><span>    ├── user.ts</span></span>
<span class="line"><span>    └── post.ts</span></span></code></pre></div><h2 id="本章导航" tabindex="-1">本章导航 <a class="header-anchor" href="#本章导航" aria-label="Permalink to &quot;本章导航&quot;">​</a></h2><ul><li><strong>2.5.1 表现层</strong>：页面组件与路由管理</li><li><strong>2.5.2 接口层</strong>：API 路由与 HTTP 处理</li><li><strong>2.5.3 业务层</strong>：核心逻辑与规则封装</li><li><strong>2.5.4 数据层</strong>：ORM 与数据库交互</li><li><strong>2.5.5 层间通信</strong>：依赖注入与接口抽象</li></ul>`,15))])}const B=p(d,[["render",g]]);export{D as __pageData,B as default};
