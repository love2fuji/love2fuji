import{_ as l,C as h,c as p,o as i,a3 as a,b as e,w as n,a as k,G as r,a4 as E}from"./chunks/framework.CUcrqFol.js";const m=JSON.parse('{"title":"4.1.4 规则可以被打破吗——反规范化：性能优化的权衡考虑","description":"4.1.4 规则可以被打破吗——反规范化：性能优化的权衡考虑 一句话破题 反范式化是为了性能而\\"故意违规\\"——用数据冗余换取查询速度。 什么时候需要反范式化？ **反范式化的触发条件**： 频繁的多表 JOIN 查询严重影响性能 某些聚合数据需要实时计算，成本过高 读多写少的场景，可以牺牲写入效率换取读取速度 常见反范","frontmatter":{"title":"4.1.4 规则可以被打破吗——反规范化：性能优化的权衡考虑","typora-root-url":"../../public"},"headers":[],"relativePath":"Advanced-old/04-database/4.1-data-modeling/4.1.4-denormalization.md","filePath":"Advanced-old/04-database/4.1-data-modeling/4.1.4-denormalization.md","lastUpdated":1766168364000}'),d={name:"Advanced-old/04-database/4.1-data-modeling/4.1.4-denormalization.md"};function g(o,s,c,y,F,C){const t=h("Mermaid");return i(),p("div",null,[s[1]||(s[1]=a('<h1 id="_4-1-4-规则可以被打破吗——反规范化-性能优化的权衡考虑" tabindex="-1">4.1.4 规则可以被打破吗——反规范化：性能优化的权衡考虑 <a class="header-anchor" href="#_4-1-4-规则可以被打破吗——反规范化-性能优化的权衡考虑" aria-label="Permalink to &quot;4.1.4 规则可以被打破吗——反规范化：性能优化的权衡考虑&quot;">​</a></h1><h3 id="一句话破题" tabindex="-1">一句话破题 <a class="header-anchor" href="#一句话破题" aria-label="Permalink to &quot;一句话破题&quot;">​</a></h3><p>反范式化是为了性能而&quot;故意违规&quot;——用数据冗余换取查询速度。</p><h3 id="什么时候需要反范式化" tabindex="-1">什么时候需要反范式化？ <a class="header-anchor" href="#什么时候需要反范式化" aria-label="Permalink to &quot;什么时候需要反范式化？&quot;">​</a></h3>',4)),(i(),e(E,null,{default:n(()=>[r(t,{id:"mermaid-12",class:"mermaid",graph:"graph%20TD%0A%20%20%20%20A%5B%22%E9%81%B5%E5%AE%88%E8%8C%83%E5%BC%8F%E8%AE%BE%E8%AE%A1%22%5D%20--%3E%20B%7B%22%E9%81%87%E5%88%B0%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%3F%22%7D%0A%20%20%20%20B%20--%20%22%E5%90%A6%22%20--%3E%20C%5B%22%E4%BF%9D%E6%8C%81%E7%8E%B0%E7%8A%B6%22%5D%0A%20%20%20%20B%20--%20%22%E6%98%AF%22%20--%3E%20D%7B%22%E8%83%BD%E9%80%9A%E8%BF%87%E7%B4%A2%E5%BC%95%E8%A7%A3%E5%86%B3%3F%22%7D%0A%20%20%20%20D%20--%20%22%E6%98%AF%22%20--%3E%20E%5B%22%E6%B7%BB%E5%8A%A0%E7%B4%A2%E5%BC%95%22%5D%0A%20%20%20%20D%20--%20%22%E5%90%A6%22%20--%3E%20F%5B%22%E8%80%83%E8%99%91%E5%8F%8D%E8%8C%83%E5%BC%8F%E5%8C%96%22%5D%0A"})]),fallback:n(()=>[...s[0]||(s[0]=[k(" Loading... ",-1)])]),_:1})),s[2]||(s[2]=a(`<p><strong>反范式化的触发条件</strong>：</p><ol><li>频繁的多表 JOIN 查询严重影响性能</li><li>某些聚合数据需要实时计算，成本过高</li><li>读多写少的场景，可以牺牲写入效率换取读取速度</li></ol><h3 id="常见反范式化策略" tabindex="-1">常见反范式化策略 <a class="header-anchor" href="#常见反范式化策略" aria-label="Permalink to &quot;常见反范式化策略&quot;">​</a></h3><h4 id="策略一-冗余存储" tabindex="-1">策略一：冗余存储 <a class="header-anchor" href="#策略一-冗余存储" aria-label="Permalink to &quot;策略一：冗余存储&quot;">​</a></h4><p><strong>场景</strong>：文章列表需要显示作者名称，每次都 JOIN 用户表成本高。</p><p><strong>规范化设计</strong>：</p><div class="language-prisma vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">prisma</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">model</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  id       </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> @id</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  title    </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  authorId </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  author   </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">User</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   @relation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">fields</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">authorId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">references</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>反范式化设计</strong>：</p><div class="language-prisma vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">prisma</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">model</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  id         </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> @id</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  title      </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  authorId   </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  authorName </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 冗余存储作者名称</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  author     </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">User</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @relation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">fields</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">authorId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">references</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>代价</strong>：用户改名时，需要同步更新所有相关文章。</p><h4 id="策略二-预计算聚合" tabindex="-1">策略二：预计算聚合 <a class="header-anchor" href="#策略二-预计算聚合" aria-label="Permalink to &quot;策略二：预计算聚合&quot;">​</a></h4><p><strong>场景</strong>：显示文章的评论数、点赞数。</p><p><strong>规范化做法</strong>：每次查询时 COUNT</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> post</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> prisma.post.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">findUnique</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  where: { id },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  include: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    _count: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      select: { comments: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, likes: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p><strong>反范式化做法</strong>：存储计数器</p><div class="language-prisma vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">prisma</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">model</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  id           </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> @id</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  title        </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  commentCount </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 冗余计数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  likeCount    </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 冗余计数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>维护方式</strong>：评论/点赞时更新计数器</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> prisma.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$transaction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  prisma.comment.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ data: { postId, content } }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  prisma.post.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    where: { id: postId },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    data: { commentCount: { increment: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span></code></pre></div><h4 id="策略三-物化视图-缓存表" tabindex="-1">策略三：物化视图/缓存表 <a class="header-anchor" href="#策略三-物化视图-缓存表" aria-label="Permalink to &quot;策略三：物化视图/缓存表&quot;">​</a></h4><p><strong>场景</strong>：复杂的统计报表查询。</p><p><strong>做法</strong>：定期生成汇总数据表</p><div class="language-prisma vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">prisma</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 每日销售汇总表</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">model</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DailySalesSummary</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  id        </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   @id</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> @default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cuid</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  date      </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">DateTime</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> @unique</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  totalSales </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Decimal</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  orderCount </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  createdAt </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">DateTime</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> @default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>更新策略</strong>：</p><ul><li>定时任务每天凌晨生成</li><li>或实时更新（通过触发器或应用层）</li></ul><h3 id="反范式化的代价" tabindex="-1">反范式化的代价 <a class="header-anchor" href="#反范式化的代价" aria-label="Permalink to &quot;反范式化的代价&quot;">​</a></h3><table tabindex="0"><thead><tr><th>获得</th><th>付出</th></tr></thead><tbody><tr><td>读取速度快</td><td>写入需要维护多处</td></tr><tr><td>减少 JOIN</td><td>数据可能不一致</td></tr><tr><td>查询简单</td><td>存储空间增加</td></tr></tbody></table><h3 id="维护数据一致性的方法" tabindex="-1">维护数据一致性的方法 <a class="header-anchor" href="#维护数据一致性的方法" aria-label="Permalink to &quot;维护数据一致性的方法&quot;">​</a></h3><p><strong>方法一：事务保证</strong></p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> prisma.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$transaction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">tx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 更新主数据</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tx.user.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    where: { id: userId },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    data: { name: newName }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 同步更新冗余数据</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tx.post.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">updateMany</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    where: { authorId: userId },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    data: { authorName: newName }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p><strong>方法二：最终一致性</strong></p><p>对于非关键数据，可以接受短暂的不一致：</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 异步更新冗余数据</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> queue.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;syncAuthorName&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { userId, newName })</span></span></code></pre></div><p><strong>方法三：数据库触发器</strong></p><p>在数据库层面自动同步（不推荐，会增加复杂度）。</p><h3 id="决策检查清单" tabindex="-1">决策检查清单 <a class="header-anchor" href="#决策检查清单" aria-label="Permalink to &quot;决策检查清单&quot;">​</a></h3><p>在决定反范式化之前，问自己：</p><ul><li>[ ] <strong>确实有性能问题吗</strong>？有实际的监控数据支撑吗？</li><li>[ ] <strong>其他方案试过了吗</strong>？索引、缓存、查询优化？</li><li>[ ] <strong>能接受数据不一致的风险吗</strong>？</li><li>[ ] <strong>有能力维护数据同步逻辑吗</strong>？</li><li>[ ] <strong>未来数据量增长后还适用吗</strong>？</li></ul><h3 id="vibe-coding-中的实践建议" tabindex="-1">Vibe Coding 中的实践建议 <a class="header-anchor" href="#vibe-coding-中的实践建议" aria-label="Permalink to &quot;Vibe Coding 中的实践建议&quot;">​</a></h3><ol><li><strong>初期不要反范式化</strong>：先按范式设计，保持简单</li><li><strong>用监控指导优化</strong>：有数据支撑再做决策</li><li><strong>让 AI 帮你评估</strong>：<div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>我的 Post 表每秒查询 1000 次，每次都需要 JOIN User 表获取作者名。</span></span>
<span class="line"><span>你觉得我应该冗余存储 authorName 吗？有什么风险？</span></span></code></pre></div></li></ol><h3 id="本节小结" tabindex="-1">本节小结 <a class="header-anchor" href="#本节小结" aria-label="Permalink to &quot;本节小结&quot;">​</a></h3><ul><li>反范式化是为性能而做的权衡</li><li>常见策略：冗余存储、预计算聚合、物化视图</li><li>代价是需要维护数据一致性</li><li>先遵守范式，遇到真实性能问题再反范式化</li></ul>`,41))])}const B=l(d,[["render",g]]);export{m as __pageData,B as default};
