import{_ as h,C as l,c as p,o as i,a3 as a,b as k,w as t,a as e,G as d,a4 as r}from"./chunks/framework.CUcrqFol.js";const u=JSON.parse('{"title":"4.2.3 转账为什么是安全的——事务特性：ACID 属性与隔离级别","description":"4.2.3 转账为什么是安全的——事务特性：ACID 属性与隔离级别 一句话破题 事务保证多个操作\\"要么全成功，要么全失败\\"——这是数据安全的基石。 经典案例：银行转账 张三给李四转账 100 元，需要两步操作： 张三账户 -100 元 李四账户 +100 元 **如果没有事务**： 第一步成功，第二步失败 → 张三少","frontmatter":{"title":"4.2.3 转账为什么是安全的——事务特性：ACID 属性与隔离级别","typora-root-url":"../../public"},"headers":[],"relativePath":"Advanced-old/04-database/4.2-rdbms-basics/4.2.3-transactions.md","filePath":"Advanced-old/04-database/4.2-rdbms-basics/4.2.3-transactions.md","lastUpdated":1766168364000}'),E={name:"Advanced-old/04-database/4.2-rdbms-basics/4.2.3-transactions.md"};function g(y,s,o,c,F,A){const n=l("Mermaid");return i(),p("div",null,[s[1]||(s[1]=a('<h1 id="_4-2-3-转账为什么是安全的——事务特性-acid-属性与隔离级别" tabindex="-1">4.2.3 转账为什么是安全的——事务特性：ACID 属性与隔离级别 <a class="header-anchor" href="#_4-2-3-转账为什么是安全的——事务特性-acid-属性与隔离级别" aria-label="Permalink to &quot;4.2.3 转账为什么是安全的——事务特性：ACID 属性与隔离级别&quot;">​</a></h1><h3 id="一句话破题" tabindex="-1">一句话破题 <a class="header-anchor" href="#一句话破题" aria-label="Permalink to &quot;一句话破题&quot;">​</a></h3><p>事务保证多个操作&quot;要么全成功，要么全失败&quot;——这是数据安全的基石。</p><h3 id="经典案例-银行转账" tabindex="-1">经典案例：银行转账 <a class="header-anchor" href="#经典案例-银行转账" aria-label="Permalink to &quot;经典案例：银行转账&quot;">​</a></h3><p>张三给李四转账 100 元，需要两步操作：</p><ol><li>张三账户 -100 元</li><li>李四账户 +100 元</li></ol><p><strong>如果没有事务</strong>：</p><ul><li>第一步成功，第二步失败 → 张三少了 100，李四没收到</li><li>系统崩溃在中间 → 数据不一致</li></ul><p><strong>有事务保护</strong>：</p><ul><li>两步要么都成功</li><li>要么都回滚到操作前的状态</li></ul><h3 id="acid-四大特性" tabindex="-1">ACID 四大特性 <a class="header-anchor" href="#acid-四大特性" aria-label="Permalink to &quot;ACID 四大特性&quot;">​</a></h3>',11)),(i(),k(r,null,{default:t(()=>[d(n,{id:"mermaid-60",class:"mermaid",graph:"graph%20TB%0A%20%20%20%20ACID%5B%22ACID%20%E7%89%B9%E6%80%A7%22%5D%0A%20%20%20%20A%5B%22A%3A%20%E5%8E%9F%E5%AD%90%E6%80%A7%22%5D%0A%20%20%20%20C%5B%22C%3A%20%E4%B8%80%E8%87%B4%E6%80%A7%22%5D%0A%20%20%20%20I%5B%22I%3A%20%E9%9A%94%E7%A6%BB%E6%80%A7%22%5D%0A%20%20%20%20D%5B%22D%3A%20%E6%8C%81%E4%B9%85%E6%80%A7%22%5D%0A%20%20%20%20%0A%20%20%20%20ACID%20--%3E%20A%0A%20%20%20%20ACID%20--%3E%20C%0A%20%20%20%20ACID%20--%3E%20I%0A%20%20%20%20ACID%20--%3E%20D%0A"})]),fallback:t(()=>[...s[0]||(s[0]=[e(" Loading... ",-1)])]),_:1})),s[2]||(s[2]=a(`<table tabindex="0"><thead><tr><th>特性</th><th>说明</th><th>保证什么</th></tr></thead><tbody><tr><td><strong>A</strong>tomicity</td><td>原子性</td><td>全部成功或全部回滚</td></tr><tr><td><strong>C</strong>onsistency</td><td>一致性</td><td>数据始终符合业务规则</td></tr><tr><td><strong>I</strong>solation</td><td>隔离性</td><td>并发事务互不干扰</td></tr><tr><td><strong>D</strong>urability</td><td>持久性</td><td>提交后数据永久保存</td></tr></tbody></table><h3 id="prisma-中使用事务" tabindex="-1">Prisma 中使用事务 <a class="header-anchor" href="#prisma-中使用事务" aria-label="Permalink to &quot;Prisma 中使用事务&quot;">​</a></h3><p><strong>方式一：顺序事务</strong></p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 所有操作在同一个事务中执行</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> prisma.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$transaction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  prisma.user.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ data: { email: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;user@example.com&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  prisma.post.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ data: { title: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;新文章&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, authorId: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;xxx&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span></code></pre></div><p><strong>方式二：交互式事务（推荐）</strong></p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 更灵活，可以在事务中编写业务逻辑</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> prisma.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$transaction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">tx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 1. 扣减张三余额</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sender</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tx.account.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    where: { userId: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;zhangsan&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    data: { balance: { decrement: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 2. 检查余额是否足够</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (sender.balance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;余额不足&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 抛出异常会自动回滚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 3. 增加李四余额</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> receiver</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tx.account.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    where: { userId: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;lisi&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    data: { balance: { increment: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { sender, receiver }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><h3 id="事务的隔离级别" tabindex="-1">事务的隔离级别 <a class="header-anchor" href="#事务的隔离级别" aria-label="Permalink to &quot;事务的隔离级别&quot;">​</a></h3><p>不同隔离级别决定了事务之间能&quot;看到&quot;彼此的多少：</p><table tabindex="0"><thead><tr><th>隔离级别</th><th>脏读</th><th>不可重复读</th><th>幻读</th><th>性能</th></tr></thead><tbody><tr><td>Read Uncommitted</td><td>✓</td><td>✓</td><td>✓</td><td>最高</td></tr><tr><td>Read Committed</td><td>✗</td><td>✓</td><td>✓</td><td>高</td></tr><tr><td>Repeatable Read</td><td>✗</td><td>✗</td><td>✓</td><td>中</td></tr><tr><td>Serializable</td><td>✗</td><td>✗</td><td>✗</td><td>低</td></tr></tbody></table><p><strong>PostgreSQL 默认</strong>：Read Committed</p><p><strong>设置隔离级别</strong>（Prisma）：</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> prisma.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$transaction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">tx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* ... */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    isolationLevel: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Serializable&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h3 id="常见问题解释" tabindex="-1">常见问题解释 <a class="header-anchor" href="#常见问题解释" aria-label="Permalink to &quot;常见问题解释&quot;">​</a></h3><p><strong>脏读</strong>：读到了其他事务未提交的数据</p><p><strong>不可重复读</strong>：同一事务内，两次读取同一数据结果不同</p><p><strong>幻读</strong>：同一事务内，两次查询记录数不同（有新增或删除）</p><h3 id="事务的最佳实践" tabindex="-1">事务的最佳实践 <a class="header-anchor" href="#事务的最佳实践" aria-label="Permalink to &quot;事务的最佳实践&quot;">​</a></h3><ol><li><p><strong>事务要短</strong>：长事务会占用数据库连接和锁资源</p></li><li><p><strong>避免事务中调用外部服务</strong>：</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 错误示例</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> prisma.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$transaction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">tx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tx.order.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> })</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> callPaymentAPI</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 外部调用可能很慢</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 正确做法：先调用外部服务，再在事务中更新数据库</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> paymentResult</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> callPaymentAPI</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> prisma.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$transaction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">tx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tx.order.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ data: { status: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;PAID&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div></li><li><p><strong>设置超时时间</strong>：</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> prisma.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$transaction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">tx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* ... */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  { timeout: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 5秒超时</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div></li></ol><h3 id="什么时候需要事务" tabindex="-1">什么时候需要事务？ <a class="header-anchor" href="#什么时候需要事务" aria-label="Permalink to &quot;什么时候需要事务？&quot;">​</a></h3><table tabindex="0"><thead><tr><th>场景</th><th>是否需要事务</th></tr></thead><tbody><tr><td>单条数据的 CRUD</td><td>不需要（自带原子性）</td></tr><tr><td>转账（多表更新）</td><td>需要</td></tr><tr><td>创建订单 + 扣减库存</td><td>需要</td></tr><tr><td>级联删除</td><td>可用事务或数据库级联</td></tr></tbody></table><h3 id="本节小结" tabindex="-1">本节小结 <a class="header-anchor" href="#本节小结" aria-label="Permalink to &quot;本节小结&quot;">​</a></h3><ul><li>事务保证多个操作的原子性</li><li>ACID 是事务的四大特性</li><li>Prisma 提供两种事务写法</li><li>事务要短，避免在事务中调用外部服务</li></ul>`,22))])}const C=h(E,[["render",g]]);export{u as __pageData,C as default};
