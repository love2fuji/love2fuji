import{_ as r,C as d,c as k,o as i,a3 as t,b as n,w as a,a as l,G as h,a4 as p}from"./chunks/framework.CUcrqFol.js";const b=JSON.parse('{"title":"8.1.4 一键还原到昨天——版本回滚：reset/revert 的使用场景","description":"8.1.4 一键还原到昨天——版本回滚 代码写崩了？别慌，Git 的回滚功能就是你的后悔药——但不同的药治不同的病。 reset vs revert：核心区别 | 特性 | git reset | git revert | |------|-----------|------------| | 原理 | 移动 HEAD","frontmatter":{"title":"8.1.4 一键还原到昨天——版本回滚：reset/revert 的使用场景","typora-root-url":"../../public"},"headers":[],"relativePath":"Advanced-old/08-workflow/8.1-git-basics/8.1.4-rollback.md","filePath":"Advanced-old/08-workflow/8.1-git-basics/8.1.4-rollback.md","lastUpdated":1766168364000}'),o={name:"Advanced-old/08-workflow/8.1-git-basics/8.1.4-rollback.md"};function F(g,s,c,C,A,E){const e=d("Mermaid");return i(),k("div",null,[s[2]||(s[2]=t('<h1 id="_8-1-4-一键还原到昨天——版本回滚" tabindex="-1">8.1.4 一键还原到昨天——版本回滚 <a class="header-anchor" href="#_8-1-4-一键还原到昨天——版本回滚" aria-label="Permalink to &quot;8.1.4 一键还原到昨天——版本回滚&quot;">​</a></h1><p>代码写崩了？别慌，Git 的回滚功能就是你的后悔药——但不同的药治不同的病。</p><h2 id="reset-vs-revert-核心区别" tabindex="-1">reset vs revert：核心区别 <a class="header-anchor" href="#reset-vs-revert-核心区别" aria-label="Permalink to &quot;reset vs revert：核心区别&quot;">​</a></h2><table tabindex="0"><thead><tr><th>特性</th><th>git reset</th><th>git revert</th></tr></thead><tbody><tr><td>原理</td><td>移动 HEAD 指针，&quot;删除&quot;历史</td><td>创建新提交来&quot;撤销&quot;变更</td></tr><tr><td>历史记录</td><td>会改变历史</td><td>保留完整历史</td></tr><tr><td>已推送代码</td><td>不推荐使用</td><td>安全使用</td></tr><tr><td>适用场景</td><td>本地未推送的提交</td><td>已推送到远程的提交</td></tr></tbody></table>',4)),(i(),n(p,null,{default:a(()=>[h(e,{id:"mermaid-70",class:"mermaid",graph:"flowchart%20TD%0A%20%20%20%20subgraph%20Reset%0A%20%20%20%20%20%20%20%20A1%5B%E6%8F%90%E4%BA%A4A%5D%20--%3E%20B1%5B%E6%8F%90%E4%BA%A4B%5D%20--%3E%20C1%5B%E6%8F%90%E4%BA%A4C%5D%0A%20%20%20%20%20%20%20%20C1%20--%3E%7Creset%7C%20A1%0A%20%20%20%20%20%20%20%20B1%20-.-%3E%7C%E8%A2%AB%E5%88%A0%E9%99%A4%7C%20X1%5B%E6%B6%88%E5%A4%B1%5D%0A%20%20%20%20%20%20%20%20C1%20-.-%3E%7C%E8%A2%AB%E5%88%A0%E9%99%A4%7C%20X1%0A%20%20%20%20end%0A%20%20%20%20%0A%20%20%20%20subgraph%20Revert%0A%20%20%20%20%20%20%20%20A2%5B%E6%8F%90%E4%BA%A4A%5D%20--%3E%20B2%5B%E6%8F%90%E4%BA%A4B%5D%20--%3E%20C2%5B%E6%8F%90%E4%BA%A4C%5D%0A%20%20%20%20%20%20%20%20C2%20--%3E%7Crevert%20B%7C%20D2%5B%E6%92%A4%E9%94%80B%E7%9A%84%E6%8F%90%E4%BA%A4%5D%0A%20%20%20%20end%0A"})]),fallback:a(()=>[...s[0]||(s[0]=[l(" Loading... ",-1)])]),_:1})),s[3]||(s[3]=t(`<h2 id="git-reset-回到过去" tabindex="-1">git reset：回到过去 <a class="header-anchor" href="#git-reset-回到过去" aria-label="Permalink to &quot;git reset：回到过去&quot;">​</a></h2><h3 id="reset-的三种模式" tabindex="-1">reset 的三种模式 <a class="header-anchor" href="#reset-的三种模式" aria-label="Permalink to &quot;reset 的三种模式&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># --soft: 保留工作区和暂存区的变更</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reset</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --soft</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HEAD~1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># --mixed (默认): 保留工作区，清空暂存区</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reset</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HEAD~1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># --hard: 工作区和暂存区全部丢弃（慎用！）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reset</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --hard</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HEAD~1</span></span></code></pre></div><table tabindex="0"><thead><tr><th>模式</th><th>工作区</th><th>暂存区</th><th>提交历史</th></tr></thead><tbody><tr><td>--soft</td><td>保留</td><td>保留</td><td>回退</td></tr><tr><td>--mixed</td><td>保留</td><td>清空</td><td>回退</td></tr><tr><td>--hard</td><td>清空</td><td>清空</td><td>回退</td></tr></tbody></table><h3 id="常见使用场景" tabindex="-1">常见使用场景 <a class="header-anchor" href="#常见使用场景" aria-label="Permalink to &quot;常见使用场景&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 场景1：撤销最近一次提交，但保留代码继续修改</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reset</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --soft</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HEAD~1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 场景2：撤销最近3次提交</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reset</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --hard</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HEAD~3</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 场景3：回退到指定提交</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reset</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --hard</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> abc1234</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 场景4：撤销 git add，但保留文件修改</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reset</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HEAD</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> file.ts</span></span></code></pre></div><h3 id="危险操作的补救" tabindex="-1">危险操作的补救 <a class="header-anchor" href="#危险操作的补救" aria-label="Permalink to &quot;危险操作的补救&quot;">​</a></h3><p>如果不小心 <code>reset --hard</code> 了，可以用 reflog 找回：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看操作历史</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reflog</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 找到丢失的提交 hash，然后恢复</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reset</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --hard</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> abc1234</span></span></code></pre></div><h2 id="git-revert-创建-反向提交" tabindex="-1">git revert：创建&quot;反向提交&quot; <a class="header-anchor" href="#git-revert-创建-反向提交" aria-label="Permalink to &quot;git revert：创建&quot;反向提交&quot;&quot;">​</a></h2><p>revert 不会删除历史，而是创建一个新提交来&quot;抵消&quot;之前的变更。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 撤销最近一次提交</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> revert</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HEAD</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 撤销指定提交</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> revert</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> abc1234</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 撤销多个连续提交</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> revert</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HEAD~3..HEAD</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 撤销但不自动提交</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> revert</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --no-commit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> abc1234</span></span></code></pre></div><h3 id="revert-合并提交" tabindex="-1">revert 合并提交 <a class="header-anchor" href="#revert-合并提交" aria-label="Permalink to &quot;revert 合并提交&quot;">​</a></h3><p>合并提交需要指定保留哪个父分支：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># -m 1 表示保留主分支（第一个父提交）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> revert</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> merge-commit-hash</span></span></code></pre></div><h2 id="场景决策指南" tabindex="-1">场景决策指南 <a class="header-anchor" href="#场景决策指南" aria-label="Permalink to &quot;场景决策指南&quot;">​</a></h2>`,16)),(i(),n(p,null,{default:a(()=>[h(e,{id:"mermaid-168",class:"mermaid",graph:"flowchart%20TD%0A%20%20%20%20A%5B%E9%9C%80%E8%A6%81%E6%92%A4%E9%94%80%E6%8F%90%E4%BA%A4%5D%20--%3E%20B%7B%E5%B7%B2%E6%8E%A8%E9%80%81%E5%88%B0%E8%BF%9C%E7%A8%8B%3F%7D%0A%20%20%20%20B%20--%3E%7C%E5%90%A6%7C%20C%7B%E9%9C%80%E8%A6%81%E4%BF%9D%E7%95%99%E4%BB%A3%E7%A0%81%3F%7D%0A%20%20%20%20B%20--%3E%7C%E6%98%AF%7C%20D%5B%E4%BD%BF%E7%94%A8%20revert%5D%0A%20%20%20%20C%20--%3E%7C%E6%98%AF%7C%20E%5Breset%20--soft%5D%0A%20%20%20%20C%20--%3E%7C%E5%90%A6%7C%20F%5Breset%20--hard%5D%0A"})]),fallback:a(()=>[...s[1]||(s[1]=[l(" Loading... ",-1)])]),_:1})),s[4]||(s[4]=t(`<h3 id="场景对照表" tabindex="-1">场景对照表 <a class="header-anchor" href="#场景对照表" aria-label="Permalink to &quot;场景对照表&quot;">​</a></h3><table tabindex="0"><thead><tr><th>场景</th><th>推荐命令</th><th>原因</th></tr></thead><tbody><tr><td>刚 commit 发现写错了</td><td><code>git reset --soft HEAD~1</code></td><td>保留代码继续修改</td></tr><tr><td>想彻底删除最近几次提交</td><td><code>git reset --hard HEAD~n</code></td><td>本地清理</td></tr><tr><td>已 push 的代码有 bug</td><td><code>git revert HEAD</code></td><td>不改变远程历史</td></tr><tr><td>想撤销某个中间提交</td><td><code>git revert abc1234</code></td><td>精准撤销单个提交</td></tr><tr><td>不小心合并了错误分支</td><td><code>git revert -m 1 merge</code></td><td>撤销合并</td></tr></tbody></table><h2 id="其他回滚技巧" tabindex="-1">其他回滚技巧 <a class="header-anchor" href="#其他回滚技巧" aria-label="Permalink to &quot;其他回滚技巧&quot;">​</a></h2><h3 id="恢复单个文件到指定版本" tabindex="-1">恢复单个文件到指定版本 <a class="header-anchor" href="#恢复单个文件到指定版本" aria-label="Permalink to &quot;恢复单个文件到指定版本&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 恢复文件到上一个版本</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> checkout</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HEAD~1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> src/file.ts</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 恢复文件到指定提交</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> checkout</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> abc1234</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> src/file.ts</span></span></code></pre></div><h3 id="暂存当前工作" tabindex="-1">暂存当前工作 <a class="header-anchor" href="#暂存当前工作" aria-label="Permalink to &quot;暂存当前工作&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 临时保存当前工作</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看 stash 列表</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stash</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 恢复最近的 stash</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stash</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pop</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 恢复指定的 stash</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stash</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stash@{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span></span></code></pre></div><h2 id="ai-协作指南" tabindex="-1">AI 协作指南 <a class="header-anchor" href="#ai-协作指南" aria-label="Permalink to &quot;AI 协作指南&quot;">​</a></h2><p><strong>核心意图</strong>：告诉 AI 你的具体情况（是否已推送、是否需要保留代码）。</p><p><strong>示例 Prompt</strong>：</p><blockquote><p>&quot;我刚 push 了一个提交到 main 分支，但发现代码有严重 bug，需要立即撤销这次提交，同时保留 Git 历史完整性，应该怎么做？&quot;</p></blockquote><h2 id="验收清单" tabindex="-1">验收清单 <a class="header-anchor" href="#验收清单" aria-label="Permalink to &quot;验收清单&quot;">​</a></h2><ul><li>[ ] 理解 reset 和 revert 的区别</li><li>[ ] 能根据场景选择正确的回滚方式</li><li>[ ] 知道如何用 reflog 找回误删的提交</li><li>[ ] 能使用 stash 暂存工作进度</li></ul>`,13))])}const y=r(o,[["render",F]]);export{b as __pageData,y as default};
