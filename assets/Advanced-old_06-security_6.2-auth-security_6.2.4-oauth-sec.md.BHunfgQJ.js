import{_ as l,C as p,c as e,o as n,j as i,b as k,a3 as r,a,w as t,G as E,a4 as d}from"./chunks/framework.CUcrqFol.js";const D=JSON.parse('{"title":"6.2.4 OAuth 2.0：授权码模式与安全配置","description":"6.2.4 OAuth 2.0：授权码模式与安全配置 本质还原 OAuth 2.0 是一个授权框架，允许第三方应用在用户授权下访问用户的资源，而无需获取用户的密码。 OAuth 2.0 授权模式 | 模式 | 适用场景 | 安全性 | |------|----------|--------| | 授权码模式 | Web","frontmatter":{"title":"6.2.4 OAuth 2.0：授权码模式与安全配置","typora-root-url":"../../public"},"headers":[],"relativePath":"Advanced-old/06-security/6.2-auth-security/6.2.4-oauth-sec.md","filePath":"Advanced-old/06-security/6.2-auth-security/6.2.4-oauth-sec.md","lastUpdated":1766168364000}'),c={name:"Advanced-old/06-security/6.2-auth-security/6.2.4-oauth-sec.md"};function g(y,s,o,F,A,C){const h=p("Mermaid");return n(),e("div",null,[s[1]||(s[1]=i("h1",{id:"_6-2-4-oauth-2-0-授权码模式与安全配置",tabindex:"-1"},[a("6.2.4 OAuth 2.0：授权码模式与安全配置 "),i("a",{class:"header-anchor",href:"#_6-2-4-oauth-2-0-授权码模式与安全配置","aria-label":'Permalink to "6.2.4 OAuth 2.0：授权码模式与安全配置"'},"​")],-1)),s[2]||(s[2]=i("h2",{id:"本质还原",tabindex:"-1"},[a("本质还原 "),i("a",{class:"header-anchor",href:"#本质还原","aria-label":'Permalink to "本质还原"'},"​")],-1)),s[3]||(s[3]=i("p",null,"OAuth 2.0 是一个授权框架，允许第三方应用在用户授权下访问用户的资源，而无需获取用户的密码。",-1)),(n(),k(d,null,{default:t(()=>[E(h,{id:"mermaid-9",class:"mermaid",graph:"sequenceDiagram%0A%20%20%20%20participant%20User%20as%20%E7%94%A8%E6%88%B7%0A%20%20%20%20participant%20App%20as%20%E4%BD%A0%E7%9A%84%E5%BA%94%E7%94%A8%0A%20%20%20%20participant%20Auth%20as%20%E6%8E%88%E6%9D%83%E6%9C%8D%E5%8A%A1%E5%99%A8%0A%20%20%20%20participant%20API%20as%20%E8%B5%84%E6%BA%90%E6%9C%8D%E5%8A%A1%E5%99%A8%0A%20%20%20%20%0A%20%20%20%20User-%3E%3EApp%3A%20%E7%82%B9%E5%87%BB%22%E7%94%A8%20Google%20%E7%99%BB%E5%BD%95%22%0A%20%20%20%20App-%3E%3EAuth%3A%20%E9%87%8D%E5%AE%9A%E5%90%91%E5%88%B0%E6%8E%88%E6%9D%83%E9%A1%B5%E9%9D%A2%0A%20%20%20%20User-%3E%3EAuth%3A%20%E5%90%8C%E6%84%8F%E6%8E%88%E6%9D%83%0A%20%20%20%20Auth-%3E%3EApp%3A%20%E8%BF%94%E5%9B%9E%E6%8E%88%E6%9D%83%E7%A0%81%20code%0A%20%20%20%20App-%3E%3EAuth%3A%20%E7%94%A8%20code%20%E6%8D%A2%E5%8F%96%20token%0A%20%20%20%20Auth-%3E%3EApp%3A%20%E8%BF%94%E5%9B%9E%20access_token%0A%20%20%20%20App-%3E%3EAPI%3A%20%E7%94%A8%20token%20%E8%AF%B7%E6%B1%82%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%0A%20%20%20%20API-%3E%3EApp%3A%20%E8%BF%94%E5%9B%9E%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE%0A"})]),fallback:t(()=>[...s[0]||(s[0]=[a(" Loading... ",-1)])]),_:1})),s[4]||(s[4]=r(`<h2 id="oauth-2-0-授权模式" tabindex="-1">OAuth 2.0 授权模式 <a class="header-anchor" href="#oauth-2-0-授权模式" aria-label="Permalink to &quot;OAuth 2.0 授权模式&quot;">​</a></h2><table tabindex="0"><thead><tr><th>模式</th><th>适用场景</th><th>安全性</th></tr></thead><tbody><tr><td>授权码模式</td><td>Web 应用</td><td>⭐⭐⭐⭐⭐</td></tr><tr><td>PKCE</td><td>移动/SPA 应用</td><td>⭐⭐⭐⭐⭐</td></tr><tr><td>隐式模式</td><td>已废弃</td><td>⚠️ 不推荐</td></tr><tr><td>密码模式</td><td>仅自有应用</td><td>⚠️ 谨慎使用</td></tr></tbody></table><h2 id="授权码模式安全要点" tabindex="-1">授权码模式安全要点 <a class="header-anchor" href="#授权码模式安全要点" aria-label="Permalink to &quot;授权码模式安全要点&quot;">​</a></h2><h3 id="_1-state-参数防止-csrf" tabindex="-1">1. State 参数防止 CSRF <a class="header-anchor" href="#_1-state-参数防止-csrf" aria-label="Permalink to &quot;1. State 参数防止 CSRF&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 生成 state</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> state</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> crypto.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">randomBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;hex&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">session.oauthState </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 发起授权请求时带上 state</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> authUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`https://accounts.google.com/oauth?</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  client_id=\${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CLIENT_ID</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}&amp;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  redirect_uri=\${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">REDIRECT_URI</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}&amp;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  state=\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">state</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}&amp;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  response_type=code\`</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 回调时验证 state</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (request.query.state </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> session.oauthState) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;State 验证失败，可能是 CSRF 攻击&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_2-pkce-防止授权码劫持" tabindex="-1">2. PKCE 防止授权码劫持 <a class="header-anchor" href="#_2-pkce-防止授权码劫持" aria-label="Permalink to &quot;2. PKCE 防止授权码劫持&quot;">​</a></h3><p>PKCE（Proof Key for Code Exchange）为 SPA 和移动应用提供额外保护：</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> crypto </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;crypto&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 生成 code_verifier（随机字符串）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> codeVerifier</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> crypto.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">randomBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;base64url&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 生成 code_challenge</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> codeChallenge</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> crypto</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createHash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;sha256&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(codeVerifier)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">digest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;base64url&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 授权请求带上 challenge</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> authUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`\${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AUTH_URL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}?</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  code_challenge=\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">codeChallenge</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}&amp;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  code_challenge_method=S256\`</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 换取 token 时带上 verifier</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tokenResponse</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TOKEN_URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  method: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;POST&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  body: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> URLSearchParams</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    code,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    code_verifier: codeVerifier,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ...其他参数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><h3 id="_3-安全存储-client-secret" tabindex="-1">3. 安全存储 Client Secret <a class="header-anchor" href="#_3-安全存储-client-secret" aria-label="Permalink to &quot;3. 安全存储 Client Secret&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ❌ 危险：Secret 暴露在前端</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/oauth/token&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  body: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    client_secret: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;my-secret&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 暴露在浏览器中！</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ✅ 安全：Secret 只在服务端使用</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// app/api/auth/callback/route.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request.url).searchParams.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;code&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 在服务端使用 secret</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> token</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> exchangeCodeForToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(code, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    client_secret: process.env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CLIENT_SECRET</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 环境变量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="nextauth-中的-oauth-安全" tabindex="-1">NextAuth 中的 OAuth 安全 <a class="header-anchor" href="#nextauth-中的-oauth-安全" aria-label="Permalink to &quot;NextAuth 中的 OAuth 安全&quot;">​</a></h2><p>NextAuth 已经内置了这些安全措施：</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> GoogleProvider </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;next-auth/providers/google&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> authOptions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  providers: [</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    GoogleProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      clientId: process.env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GOOGLE_CLIENT_ID</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      clientSecret: process.env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GOOGLE_CLIENT_SECRET</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // NextAuth 自动处理：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // - state 参数</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // - PKCE（如果 provider 支持）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // - 安全的 token 存储</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="token-安全存储" tabindex="-1">Token 安全存储 <a class="header-anchor" href="#token-安全存储" aria-label="Permalink to &quot;Token 安全存储&quot;">​</a></h2><table tabindex="0"><thead><tr><th>存储位置</th><th>安全性</th><th>说明</th></tr></thead><tbody><tr><td>HttpOnly Cookie</td><td>✅ 推荐</td><td>防 XSS</td></tr><tr><td>localStorage</td><td>❌ 不推荐</td><td>易被 XSS 窃取</td></tr><tr><td>sessionStorage</td><td>❌ 不推荐</td><td>易被 XSS 窃取</td></tr><tr><td>内存</td><td>✅ 可用</td><td>刷新页面丢失</td></tr></tbody></table><div class="warning custom-block"><p class="custom-block-title">OAuth 安全检查清单</p><ol><li>[ ] 使用授权码模式，不用隐式模式</li><li>[ ] SPA/移动应用使用 PKCE</li><li>[ ] 验证 state 参数防止 CSRF</li><li>[ ] Client Secret 只在服务端使用</li><li>[ ] Token 存储在 HttpOnly Cookie</li><li>[ ] 限制 redirect_uri 白名单</li></ol></div>`,16))])}const B=l(c,[["render",g]]);export{D as __pageData,B as default};
