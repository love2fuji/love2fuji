import{_ as l,C as e,c as p,o as a,a3 as i,b as h,w as n,a as r,G as d,a4 as o}from"./chunks/framework.CUcrqFol.js";const b=JSON.parse('{"title":"11.4.2 为什么会出问题——根因分析：技术原因与流程缺陷","description":"11.4.2 根因分析：技术原因与流程缺陷 一句话破题 找到问题的**根本原因**而不是表面原因。\\"数据库挂了\\"是现象，\\"连接池配置不当\\"才是根因。 核心价值 深入的根因分析能让你： 避免头痛医头脚痛医脚 发现系统性的问题 制定真正有效的改进措施 5-Why 分析法 从现象出发，连续追问\\"为什么\\"，直到找到根本原因：","frontmatter":{"title":"11.4.2 为什么会出问题——根因分析：技术原因与流程缺陷","typora-root-url":"../../public"},"headers":[],"relativePath":"Advanced-old/11-review/11.4-post-mortem/11.4.2-root-cause.md","filePath":"Advanced-old/11-review/11.4-post-mortem/11.4.2-root-cause.md","lastUpdated":1766168364000}'),k={name:"Advanced-old/11-review/11.4-post-mortem/11.4.2-root-cause.md"};function E(c,s,g,A,u,B){const t=e("Mermaid");return a(),p("div",null,[s[1]||(s[1]=i(`<h1 id="_11-4-2-根因分析-技术原因与流程缺陷" tabindex="-1">11.4.2 根因分析：技术原因与流程缺陷 <a class="header-anchor" href="#_11-4-2-根因分析-技术原因与流程缺陷" aria-label="Permalink to &quot;11.4.2 根因分析：技术原因与流程缺陷&quot;">​</a></h1><h2 id="一句话破题" tabindex="-1">一句话破题 <a class="header-anchor" href="#一句话破题" aria-label="Permalink to &quot;一句话破题&quot;">​</a></h2><p>找到问题的<strong>根本原因</strong>而不是表面原因。&quot;数据库挂了&quot;是现象，&quot;连接池配置不当&quot;才是根因。</p><h2 id="核心价值" tabindex="-1">核心价值 <a class="header-anchor" href="#核心价值" aria-label="Permalink to &quot;核心价值&quot;">​</a></h2><p>深入的根因分析能让你：</p><ul><li>避免头痛医头脚痛医脚</li><li>发现系统性的问题</li><li>制定真正有效的改进措施</li></ul><h2 id="_5-why-分析法" tabindex="-1">5-Why 分析法 <a class="header-anchor" href="#_5-why-分析法" aria-label="Permalink to &quot;5-Why 分析法&quot;">​</a></h2><p>从现象出发，连续追问&quot;为什么&quot;，直到找到根本原因：</p><div class="language-markdown vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">markdown</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">## 5-Why 分析</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-light-font-weight:bold;--shiki-dark:#E1E4E8;--shiki-dark-font-weight:bold;">**现象：用户无法登录**</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">1.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 为什么用户无法登录？</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   → 登录 API 返回 500 错误</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">2.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 为什么 API 返回 500？</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   → 数据库查询超时</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">3.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 为什么数据库查询超时？</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   → 数据库连接池耗尽</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">4.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 为什么连接池耗尽？</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   → 有慢查询占用连接不释放</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">5.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 为什么有慢查询？</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   → 缺少索引，且没有查询超时配置</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-light-font-weight:bold;--shiki-dark:#E1E4E8;--shiki-dark-font-weight:bold;">**根因：缺少数据库索引 + 没有配置查询超时**</span></span></code></pre></div><h2 id="根因分类" tabindex="-1">根因分类 <a class="header-anchor" href="#根因分类" aria-label="Permalink to &quot;根因分类&quot;">​</a></h2>`,10)),(a(),h(o,null,{default:n(()=>[d(t,{id:"mermaid-42",class:"mermaid",graph:"flowchart%20TD%0A%20%20%20%20A%5B%22%E9%97%AE%E9%A2%98%E6%A0%B9%E5%9B%A0%22%5D%20--%3E%20B%5B%22%E6%8A%80%E6%9C%AF%E5%8E%9F%E5%9B%A0%22%5D%0A%20%20%20%20A%20--%3E%20C%5B%22%E6%B5%81%E7%A8%8B%E7%BC%BA%E9%99%B7%22%5D%0A%20%20%20%20A%20--%3E%20D%5B%22%E4%BA%BA%E4%B8%BA%E5%9B%A0%E7%B4%A0%22%5D%0A%20%20%20%20%0A%20%20%20%20B%20--%3E%20B1%5B%22%E4%BB%A3%E7%A0%81%E7%BC%BA%E9%99%B7%22%5D%0A%20%20%20%20B%20--%3E%20B2%5B%22%E9%85%8D%E7%BD%AE%E9%94%99%E8%AF%AF%22%5D%0A%20%20%20%20B%20--%3E%20B3%5B%22%E6%9E%B6%E6%9E%84%E9%97%AE%E9%A2%98%22%5D%0A%20%20%20%20%0A%20%20%20%20C%20--%3E%20C1%5B%22%E7%BC%BA%E5%B0%91%E6%B5%8B%E8%AF%95%22%5D%0A%20%20%20%20C%20--%3E%20C2%5B%22%E7%BC%BA%E5%B0%91Review%22%5D%0A%20%20%20%20C%20--%3E%20C3%5B%22%E7%BC%BA%E5%B0%91%E7%9B%91%E6%8E%A7%22%5D%0A%20%20%20%20%0A%20%20%20%20D%20--%3E%20D1%5B%22%E6%93%8D%E4%BD%9C%E5%A4%B1%E8%AF%AF%22%5D%0A%20%20%20%20D%20--%3E%20D2%5B%22%E6%B2%9F%E9%80%9A%E4%B8%8D%E7%95%85%22%5D%0A%20%20%20%20D%20--%3E%20D3%5B%22%E7%9F%A5%E8%AF%86%E7%BC%BA%E5%A4%B1%22%5D%0A"})]),fallback:n(()=>[...s[0]||(s[0]=[r(" Loading... ",-1)])]),_:1})),s[2]||(s[2]=i(`<h2 id="技术根因分析" tabindex="-1">技术根因分析 <a class="header-anchor" href="#技术根因分析" aria-label="Permalink to &quot;技术根因分析&quot;">​</a></h2><h3 id="代码层面" tabindex="-1">代码层面 <a class="header-anchor" href="#代码层面" aria-label="Permalink to &quot;代码层面&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 问题代码：没有设置查询超时</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> prisma.user.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">findFirst</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  where: { email }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 改进后：设置超时时间</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> prisma.user.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">findFirst</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  where: { email },</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Prisma 暂不支持查询级超时，需要在连接层配置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><h3 id="配置层面" tabindex="-1">配置层面 <a class="header-anchor" href="#配置层面" aria-label="Permalink to &quot;配置层面&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 问题配置：连接池太小</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">DATABASE_URL=&quot;postgresql://user:pass@host:5432/db?connection_limit=5&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 改进配置：合理的连接池大小</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">DATABASE_URL=&quot;postgresql://user:pass@host:5432/db?connection_limit=20&amp;connect_timeout=10&quot;</span></span></code></pre></div><h2 id="流程缺陷分析" tabindex="-1">流程缺陷分析 <a class="header-anchor" href="#流程缺陷分析" aria-label="Permalink to &quot;流程缺陷分析&quot;">​</a></h2><table tabindex="0"><thead><tr><th>流程环节</th><th>检查点</th><th>本次是否缺失</th></tr></thead><tbody><tr><td><strong>开发</strong></td><td>代码审查是否发现问题？</td><td>未发现性能问题</td></tr><tr><td><strong>测试</strong></td><td>是否有性能测试？</td><td>没有压力测试</td></tr><tr><td><strong>部署</strong></td><td>是否有灰度发布？</td><td>直接全量发布</td></tr><tr><td><strong>监控</strong></td><td>是否有相关告警？</td><td>数据库监控不完善</td></tr></tbody></table><h2 id="因果图" tabindex="-1">因果图 <a class="header-anchor" href="#因果图" aria-label="Permalink to &quot;因果图&quot;">​</a></h2><p>使用鱼骨图分析多个因素：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>                    ┌─ 代码问题 ─ 没有索引</span></span>
<span class="line"><span>                    │</span></span>
<span class="line"><span>                    ├─ 配置问题 ─ 连接池太小</span></span>
<span class="line"><span>问题：登录失败 ←────┤</span></span>
<span class="line"><span>                    ├─ 流程问题 ─ 没有性能测试</span></span>
<span class="line"><span>                    │</span></span>
<span class="line"><span>                    └─ 监控问题 ─ 没有数据库告警</span></span></code></pre></div><h2 id="避坑指南" tabindex="-1">避坑指南 <a class="header-anchor" href="#避坑指南" aria-label="Permalink to &quot;避坑指南&quot;">​</a></h2><div class="danger custom-block"><p class="custom-block-title">新手最容易犯的错</p><ol><li>停留在表面原因，不深挖根因</li><li>只分析技术原因，忽略流程缺陷</li><li>5-Why 问得太少（通常需要5次以上）</li><li>把&quot;人的失误&quot;当作根因（应该问为什么会失误）</li></ol></div>`,12))])}const m=l(k,[["render",E]]);export{b as __pageData,m as default};
