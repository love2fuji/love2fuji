import{_ as h,C as p,c,o as s,j as a,b as n,a3 as l,a as d,w as e,G as o,a4 as r}from"./chunks/framework.CUcrqFol.js";const B=JSON.parse('{"title":"10.2.2 部署到底要填什么——配置要素：镜像/启动命令/端口/卷/环境变量","description":"10.2.2 部署到底要填什么——配置要素：镜像/启动命令/端口/卷/环境变量 Docker 配置看起来复杂，其实就五个核心要素。 五大核心配置要素 镜像（Image） 镜像是容器的\\"安装包\\"，包含了运行应用所需的一切：代码、运行时、库、配置文件。 镜像命名规则 | 示例 | 说明 | |------|------|","frontmatter":{"title":"10.2.2 部署到底要填什么——配置要素：镜像/启动命令/端口/卷/环境变量","typora-root-url":"../../public"},"headers":[],"relativePath":"Advanced-old/10-deploy/10.2-1panel-deployment/10.2.2-config.md","filePath":"Advanced-old/10-deploy/10.2-1panel-deployment/10.2.2-config.md","lastUpdated":1766168364000}'),E={name:"Advanced-old/10-deploy/10.2-1panel-deployment/10.2.2-config.md"};function k(b,t,A,m,u,g){const i=p("Mermaid");return s(),c("div",null,[t[2]||(t[2]=a("h1",{id:"_10-2-2-部署到底要填什么——配置要素-镜像-启动命令-端口-卷-环境变量",tabindex:"-1"},[d("10.2.2 部署到底要填什么——配置要素：镜像/启动命令/端口/卷/环境变量 "),a("a",{class:"header-anchor",href:"#_10-2-2-部署到底要填什么——配置要素-镜像-启动命令-端口-卷-环境变量","aria-label":'Permalink to "10.2.2 部署到底要填什么——配置要素：镜像/启动命令/端口/卷/环境变量"'},"​")],-1)),t[3]||(t[3]=a("p",null,"Docker 配置看起来复杂，其实就五个核心要素。",-1)),t[4]||(t[4]=a("h2",{id:"五大核心配置要素",tabindex:"-1"},[d("五大核心配置要素 "),a("a",{class:"header-anchor",href:"#五大核心配置要素","aria-label":'Permalink to "五大核心配置要素"'},"​")],-1)),(s(),n(r,null,{default:e(()=>[o(i,{id:"mermaid-9",class:"mermaid",graph:"flowchart%20TB%0A%20%20%20%20A%5BDocker%20%E5%AE%B9%E5%99%A8%E9%85%8D%E7%BD%AE%5D%20--%3E%20B%5B%E9%95%9C%E5%83%8F%5D%0A%20%20%20%20A%20--%3E%20C%5B%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84%5D%0A%20%20%20%20A%20--%3E%20D%5B%E5%8D%B7%E6%8C%82%E8%BD%BD%5D%0A%20%20%20%20A%20--%3E%20E%5B%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%5D%0A%20%20%20%20A%20--%3E%20F%5B%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4%5D%0A%20%20%20%20%0A%20%20%20%20B%20--%3E%20B1%5B%E7%94%A8%E4%BB%80%E4%B9%88%E8%BD%AF%E4%BB%B6%E5%8C%85%5D%0A%20%20%20%20C%20--%3E%20C1%5B%E6%80%8E%E4%B9%88%E8%AE%BF%E9%97%AE%E5%AE%B9%E5%99%A8%5D%0A%20%20%20%20D%20--%3E%20D1%5B%E6%95%B0%E6%8D%AE%E5%AD%98%E5%9C%A8%E5%93%AA%5D%0A%20%20%20%20E%20--%3E%20E1%5B%E8%BF%90%E8%A1%8C%E6%97%B6%E5%8F%82%E6%95%B0%5D%0A%20%20%20%20F%20--%3E%20F1%5B%E5%90%AF%E5%8A%A8%E6%97%B6%E5%B9%B2%E4%BB%80%E4%B9%88%5D%0A"})]),fallback:e(()=>[...t[0]||(t[0]=[d(" Loading... ",-1)])]),_:1})),t[5]||(t[5]=l('<h2 id="_1-镜像-image" tabindex="-1">1. 镜像（Image） <a class="header-anchor" href="#_1-镜像-image" aria-label="Permalink to &quot;1. 镜像（Image）&quot;">​</a></h2><p>镜像是容器的&quot;安装包&quot;，包含了运行应用所需的一切：代码、运行时、库、配置文件。</p><h3 id="镜像命名规则" tabindex="-1">镜像命名规则 <a class="header-anchor" href="#镜像命名规则" aria-label="Permalink to &quot;镜像命名规则&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>[仓库地址/]镜像名[:标签]</span></span></code></pre></div><table tabindex="0"><thead><tr><th>示例</th><th>说明</th></tr></thead><tbody><tr><td><code>node:18</code></td><td>Docker Hub 官方 Node.js 18</td></tr><tr><td><code>node:18-alpine</code></td><td>轻量版，体积更小</td></tr><tr><td><code>postgres:15</code></td><td>PostgreSQL 15</td></tr><tr><td><code>my-app:v1.0.0</code></td><td>自定义应用指定版本</td></tr></tbody></table><h3 id="镜像选择建议" tabindex="-1">镜像选择建议 <a class="header-anchor" href="#镜像选择建议" aria-label="Permalink to &quot;镜像选择建议&quot;">​</a></h3><table tabindex="0"><thead><tr><th>场景</th><th>推荐镜像</th><th>理由</th></tr></thead><tbody><tr><td>Node.js 应用</td><td><code>node:18-alpine</code></td><td>体积小（~120MB vs ~1GB）</td></tr><tr><td>Python 应用</td><td><code>python:3.11-slim</code></td><td>精简版，够用</td></tr><tr><td>生产数据库</td><td><code>postgres:15</code></td><td>稳定版本</td></tr></tbody></table><h2 id="_2-端口映射-port-mapping" tabindex="-1">2. 端口映射（Port Mapping） <a class="header-anchor" href="#_2-端口映射-port-mapping" aria-label="Permalink to &quot;2. 端口映射（Port Mapping）&quot;">​</a></h2><p>端口映射让外部能够访问容器内的服务。</p><h3 id="格式说明" tabindex="-1">格式说明 <a class="header-anchor" href="#格式说明" aria-label="Permalink to &quot;格式说明&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>宿主机端口:容器端口</span></span></code></pre></div><table tabindex="0"><thead><tr><th>配置</th><th>含义</th></tr></thead><tbody><tr><td><code>3000:3000</code></td><td>用 3000 访问容器的 3000 端口</td></tr><tr><td><code>8080:3000</code></td><td>用 8080 访问容器的 3000 端口</td></tr><tr><td><code>127.0.0.1:3000:3000</code></td><td>只允许本机访问</td></tr></tbody></table><h3 id="常见端口规划" tabindex="-1">常见端口规划 <a class="header-anchor" href="#常见端口规划" aria-label="Permalink to &quot;常见端口规划&quot;">​</a></h3><table tabindex="0"><thead><tr><th>服务</th><th>容器端口</th><th>建议宿主机端口</th></tr></thead><tbody><tr><td>Next.js</td><td>3000</td><td>3000</td></tr><tr><td>NestJS</td><td>3001</td><td>3001</td></tr><tr><td>PostgreSQL</td><td>5432</td><td>5432</td></tr><tr><td>Redis</td><td>6379</td><td>6379</td></tr><tr><td>Nginx</td><td>80/443</td><td>80/443</td></tr></tbody></table><div class="warning custom-block"><p class="custom-block-title">端口冲突</p><p>同一宿主机端口只能被一个容器占用。如果端口已被占用，需要修改映射端口。</p></div><h2 id="_3-卷挂载-volume-mount" tabindex="-1">3. 卷挂载（Volume Mount） <a class="header-anchor" href="#_3-卷挂载-volume-mount" aria-label="Permalink to &quot;3. 卷挂载（Volume Mount）&quot;">​</a></h2><p>容器删除后，里面的数据默认会丢失。卷挂载将数据保存到宿主机。</p><h3 id="格式说明-1" tabindex="-1">格式说明 <a class="header-anchor" href="#格式说明-1" aria-label="Permalink to &quot;格式说明&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>宿主机路径:容器路径[:权限]</span></span></code></pre></div><table tabindex="0"><thead><tr><th>配置</th><th>含义</th></tr></thead><tbody><tr><td><code>/data/postgres:/var/lib/postgresql/data</code></td><td>数据库文件持久化</td></tr><tr><td><code>/app/logs:/app/logs</code></td><td>日志文件持久化</td></tr><tr><td><code>/config:/app/config:ro</code></td><td>只读挂载配置文件</td></tr></tbody></table><h3 id="必须挂载的数据" tabindex="-1">必须挂载的数据 <a class="header-anchor" href="#必须挂载的数据" aria-label="Permalink to &quot;必须挂载的数据&quot;">​</a></h3><table tabindex="0"><thead><tr><th>服务</th><th>容器路径</th><th>数据类型</th></tr></thead><tbody><tr><td>PostgreSQL</td><td><code>/var/lib/postgresql/data</code></td><td>数据库文件</td></tr><tr><td>MySQL</td><td><code>/var/lib/mysql</code></td><td>数据库文件</td></tr><tr><td>Redis</td><td><code>/data</code></td><td>持久化数据</td></tr><tr><td>应用</td><td><code>/app/uploads</code></td><td>用户上传文件</td></tr><tr><td>应用</td><td><code>/app/logs</code></td><td>日志文件</td></tr></tbody></table><h2 id="_4-环境变量-environment-variables" tabindex="-1">4. 环境变量（Environment Variables） <a class="header-anchor" href="#_4-环境变量-environment-variables" aria-label="Permalink to &quot;4. 环境变量（Environment Variables）&quot;">​</a></h2><p>环境变量是传递配置给应用的标准方式，比硬编码更安全、更灵活。</p><h3 id="常用环境变量" tabindex="-1">常用环境变量 <a class="header-anchor" href="#常用环境变量" aria-label="Permalink to &quot;常用环境变量&quot;">​</a></h3><table tabindex="0"><thead><tr><th>变量名</th><th>作用</th><th>示例值</th></tr></thead><tbody><tr><td><code>NODE_ENV</code></td><td>运行环境</td><td><code>production</code></td></tr><tr><td><code>DATABASE_URL</code></td><td>数据库连接串</td><td><code>postgresql://user:pass@host:5432/db</code></td></tr><tr><td><code>REDIS_URL</code></td><td>Redis 连接串</td><td><code>redis://localhost:6379</code></td></tr><tr><td><code>JWT_SECRET</code></td><td>JWT 密钥</td><td><code>your-secret-key</code></td></tr><tr><td><code>PORT</code></td><td>应用监听端口</td><td><code>3000</code></td></tr></tbody></table><h3 id="环境变量安全实践" tabindex="-1">环境变量安全实践 <a class="header-anchor" href="#环境变量安全实践" aria-label="Permalink to &quot;环境变量安全实践&quot;">​</a></h3>',27)),(s(),n(r,null,{default:e(()=>[o(i,{id:"mermaid-454",class:"mermaid",graph:"flowchart%20LR%0A%20%20%20%20A%5B%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF%5D%20--%3E%20B%7B%E5%AD%98%E6%94%BE%E4%BD%8D%E7%BD%AE%7D%0A%20%20%20%20B%20--%3E%7C%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%7C%20C%5B.env.local%20%E6%96%87%E4%BB%B6%5D%0A%20%20%20%20B%20--%3E%7C%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%7C%20D%5B1Panel%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%5D%0A%20%20%20%20B%20--%3E%7C%E5%9B%A2%E9%98%9F%E5%8D%8F%E4%BD%9C%7C%20E%5B%E5%AF%86%E9%92%A5%E7%AE%A1%E7%90%86%E6%9C%8D%E5%8A%A1%5D%0A%20%20%20%20%0A%20%20%20%20style%20C%20fill%3A%23ffffcc%0A%20%20%20%20style%20D%20fill%3A%23ccffcc%0A%20%20%20%20style%20E%20fill%3A%23ccccff%0A"})]),fallback:e(()=>[...t[1]||(t[1]=[d(" Loading... ",-1)])]),_:1})),t[6]||(t[6]=l(`<div class="danger custom-block"><p class="custom-block-title">安全警告</p><p>绝对不要在代码仓库中提交真实的数据库密码、API 密钥等敏感信息！</p></div><h2 id="_5-启动命令-command" tabindex="-1">5. 启动命令（Command） <a class="header-anchor" href="#_5-启动命令-command" aria-label="Permalink to &quot;5. 启动命令（Command）&quot;">​</a></h2><p>启动命令决定容器启动后执行什么操作。</p><h3 id="常见启动命令" tabindex="-1">常见启动命令 <a class="header-anchor" href="#常见启动命令" aria-label="Permalink to &quot;常见启动命令&quot;">​</a></h3><table tabindex="0"><thead><tr><th>应用类型</th><th>启动命令</th></tr></thead><tbody><tr><td>Next.js 生产</td><td><code>npm run start</code> 或 <code>node server.js</code></td></tr><tr><td>NestJS 生产</td><td><code>node dist/main.js</code></td></tr><tr><td>开发调试</td><td><code>npm run dev</code>（不推荐生产使用）</td></tr></tbody></table><h3 id="dockerfile-中的-cmd-vs-entrypoint" tabindex="-1">Dockerfile 中的 CMD vs ENTRYPOINT <a class="header-anchor" href="#dockerfile-中的-cmd-vs-entrypoint" aria-label="Permalink to &quot;Dockerfile 中的 CMD vs ENTRYPOINT&quot;">​</a></h3><table tabindex="0"><thead><tr><th>指令</th><th>特点</th></tr></thead><tbody><tr><td><code>CMD</code></td><td>可被运行时命令覆盖</td></tr><tr><td><code>ENTRYPOINT</code></td><td>固定执行，运行时参数追加</td></tr></tbody></table><h2 id="完整配置示例" tabindex="-1">完整配置示例 <a class="header-anchor" href="#完整配置示例" aria-label="Permalink to &quot;完整配置示例&quot;">​</a></h2><p>以 Next.js 应用为例：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># docker-compose.yml 等效配置</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  nextjs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">node:18-alpine</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    container_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">my-nextjs-app</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;3000:3000&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./app:/app</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/app/node_modules</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 排除 node_modules</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">NODE_ENV=production</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">DATABASE_URL=postgresql://user:pass@postgres:5432/mydb</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    command</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">npm run start</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    restart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">always</span></span></code></pre></div><p>对应 1Panel 配置：</p><table tabindex="0"><thead><tr><th>配置项</th><th>值</th></tr></thead><tbody><tr><td>镜像</td><td><code>node:18-alpine</code></td></tr><tr><td>容器名</td><td><code>my-nextjs-app</code></td></tr><tr><td>端口</td><td><code>3000:3000</code></td></tr><tr><td>挂载</td><td><code>./app:/app</code></td></tr><tr><td>环境变量</td><td><code>NODE_ENV=production</code></td></tr><tr><td>命令</td><td><code>npm run start</code></td></tr><tr><td>重启策略</td><td><code>always</code></td></tr></tbody></table><h2 id="配置验证清单" tabindex="-1">配置验证清单 <a class="header-anchor" href="#配置验证清单" aria-label="Permalink to &quot;配置验证清单&quot;">​</a></h2><p>部署前检查：</p><ul><li>[ ] 镜像版本是否正确</li><li>[ ] 端口是否冲突</li><li>[ ] 数据目录是否挂载</li><li>[ ] 敏感信息是否使用环境变量</li><li>[ ] 重启策略是否设置为 always</li></ul>`,15))])}const D=h(E,[["render",k]]);export{B as __pageData,D as default};
