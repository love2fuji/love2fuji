import{_ as t,C as l,c as h,o as i,a3 as a,b as p,w as n,a as k,G as r,a4 as E}from"./chunks/framework.CUcrqFol.js";const b=JSON.parse('{"title":"11.2.4 CI/CD 里的密码——密钥管理：CI/CD 环境配置与安全存储","description":"11.2.4 密钥管理：CI/CD 环境配置与安全存储 一句话破题 敏感信息（API Key、数据库密码、SSH 密钥等）**绝不能写在代码中**，应使用 GitHub Secrets 安全存储。 核心价值 正确管理密钥能让你： 避免敏感信息泄露 安全地在 CI/CD 中使用密钥 便于密钥轮换和权限管理 配置 GitH","frontmatter":{"title":"11.2.4 CI/CD 里的密码——密钥管理：CI/CD 环境配置与安全存储","typora-root-url":"../../public"},"headers":[],"relativePath":"Advanced-old/11-review/11.2-cd/11.2.4-secrets.md","filePath":"Advanced-old/11-review/11.2-cd/11.2.4-secrets.md","lastUpdated":1766168364000}'),d={name:"Advanced-old/11-review/11.2-cd/11.2.4-secrets.md"};function c(o,s,g,y,u,A){const e=l("Mermaid");return i(),h("div",null,[s[1]||(s[1]=a(`<h1 id="_11-2-4-密钥管理-ci-cd-环境配置与安全存储" tabindex="-1">11.2.4 密钥管理：CI/CD 环境配置与安全存储 <a class="header-anchor" href="#_11-2-4-密钥管理-ci-cd-环境配置与安全存储" aria-label="Permalink to &quot;11.2.4 密钥管理：CI/CD 环境配置与安全存储&quot;">​</a></h1><h2 id="一句话破题" tabindex="-1">一句话破题 <a class="header-anchor" href="#一句话破题" aria-label="Permalink to &quot;一句话破题&quot;">​</a></h2><p>敏感信息（API Key、数据库密码、SSH 密钥等）<strong>绝不能写在代码中</strong>，应使用 GitHub Secrets 安全存储。</p><h2 id="核心价值" tabindex="-1">核心价值 <a class="header-anchor" href="#核心价值" aria-label="Permalink to &quot;核心价值&quot;">​</a></h2><p>正确管理密钥能让你：</p><ul><li>避免敏感信息泄露</li><li>安全地在 CI/CD 中使用密钥</li><li>便于密钥轮换和权限管理</li></ul><h2 id="配置-github-secrets" tabindex="-1">配置 GitHub Secrets <a class="header-anchor" href="#配置-github-secrets" aria-label="Permalink to &quot;配置 GitHub Secrets&quot;">​</a></h2><h3 id="在仓库设置中添加" tabindex="-1">在仓库设置中添加 <a class="header-anchor" href="#在仓库设置中添加" aria-label="Permalink to &quot;在仓库设置中添加&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Settings → Secrets and variables → Actions → New repository secret</span></span>
<span class="line"><span></span></span>
<span class="line"><span>添加：</span></span>
<span class="line"><span>- DATABASE_URL</span></span>
<span class="line"><span>- VERCEL_TOKEN</span></span>
<span class="line"><span>- SSH_PRIVATE_KEY</span></span></code></pre></div><h3 id="在-workflow-中使用" tabindex="-1">在 Workflow 中使用 <a class="header-anchor" href="#在-workflow-中使用" aria-label="Permalink to &quot;在 Workflow 中使用&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">jobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  deploy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    runs-on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ubuntu-latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    steps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Use secret</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          DATABASE_URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ secrets.DATABASE_URL }}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          echo &quot;Database configured&quot;  # 不要打印实际值！</span></span></code></pre></div><h2 id="环境级别的-secrets" tabindex="-1">环境级别的 Secrets <a class="header-anchor" href="#环境级别的-secrets" aria-label="Permalink to &quot;环境级别的 Secrets&quot;">​</a></h2><p>不同环境使用不同的密钥：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">jobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  deploy-staging</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">staging</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 使用 staging 环境的 secrets</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    steps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          API_KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ secrets.API_KEY }}</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # staging 的 API_KEY</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  deploy-production</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">production</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 使用 production 环境的 secrets</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    steps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          API_KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ secrets.API_KEY }}</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # production 的 API_KEY</span></span></code></pre></div><p>在 GitHub 中配置：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Settings → Environments → New environment</span></span>
<span class="line"><span>→ 创建 staging 和 production</span></span>
<span class="line"><span>→ 在各自环境中添加对应的 secrets</span></span></code></pre></div><h2 id="常见密钥类型及使用" tabindex="-1">常见密钥类型及使用 <a class="header-anchor" href="#常见密钥类型及使用" aria-label="Permalink to &quot;常见密钥类型及使用&quot;">​</a></h2><h3 id="ssh-密钥" tabindex="-1">SSH 密钥 <a class="header-anchor" href="#ssh-密钥" aria-label="Permalink to &quot;SSH 密钥&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Setup SSH</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    mkdir -p ~/.ssh</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    echo &quot;\${{ secrets.SSH_PRIVATE_KEY }}&quot; &gt; ~/.ssh/id_rsa</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    chmod 600 ~/.ssh/id_rsa</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    ssh-keyscan github.com &gt;&gt; ~/.ssh/known_hosts</span></span></code></pre></div><h3 id="docker-registry-认证" tabindex="-1">Docker Registry 认证 <a class="header-anchor" href="#docker-registry-认证" aria-label="Permalink to &quot;Docker Registry 认证&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Login to Docker Hub</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">docker/login-action@v3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    username</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ secrets.DOCKER_USERNAME }}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    password</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ secrets.DOCKER_PASSWORD }}</span></span></code></pre></div><h3 id="云服务商凭证" tabindex="-1">云服务商凭证 <a class="header-anchor" href="#云服务商凭证" aria-label="Permalink to &quot;云服务商凭证&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Configure AWS Credentials</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">aws-actions/configure-aws-credentials@v4</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    aws-access-key-id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ secrets.AWS_ACCESS_KEY_ID }}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    aws-secret-access-key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ secrets.AWS_SECRET_ACCESS_KEY }}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    aws-region</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">us-east-1</span></span></code></pre></div><h2 id="密钥轮换最佳实践" tabindex="-1">密钥轮换最佳实践 <a class="header-anchor" href="#密钥轮换最佳实践" aria-label="Permalink to &quot;密钥轮换最佳实践&quot;">​</a></h2>`,24)),(i(),p(E,null,{default:n(()=>[r(e,{id:"mermaid-72",class:"mermaid",graph:"flowchart%20LR%0A%20%20%20%20New%5B%22%E7%94%9F%E6%88%90%E6%96%B0%E5%AF%86%E9%92%A5%22%5D%20--%3E%20Add%5B%22%E6%B7%BB%E5%8A%A0%E5%88%B0%20GitHub%20Secrets%22%5D%0A%20%20%20%20Add%20--%3E%20Test%5B%22%E6%B5%8B%E8%AF%95%20CI%2FCD%20%E6%B5%81%E7%A8%8B%22%5D%0A%20%20%20%20Test%20--%3E%20Remove%5B%22%E7%A7%BB%E9%99%A4%E6%97%A7%E5%AF%86%E9%92%A5%22%5D%0A%20%20%20%20Remove%20--%3E%20Revoke%5B%22%E6%92%A4%E9%94%80%E6%97%A7%E5%AF%86%E9%92%A5%E6%9D%83%E9%99%90%22%5D%0A"})]),fallback:n(()=>[...s[0]||(s[0]=[k(" Loading... ",-1)])]),_:1})),s[2]||(s[2]=a(`<h2 id="安全检查" tabindex="-1">安全检查 <a class="header-anchor" href="#安全检查" aria-label="Permalink to &quot;安全检查&quot;">​</a></h2><p>在 PR 中防止意外提交密钥：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Check for secrets</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    # 简单的敏感信息检查</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    if grep -rE &quot;(password|secret|api.key)\\s*=\\s*[&#39;\\&quot;][^&#39;\\&quot;]+[&#39;\\&quot;]&quot; --include=&quot;*.ts&quot; .; then</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      echo &quot;Potential secret found in code!&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      exit 1</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    fi</span></span></code></pre></div><p>或使用专业工具：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Scan for secrets</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">trufflesecurity/trufflehog@main</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    base</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">main</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    head</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">HEAD</span></span></code></pre></div><h2 id="避坑指南" tabindex="-1">避坑指南 <a class="header-anchor" href="#避坑指南" aria-label="Permalink to &quot;避坑指南&quot;">​</a></h2><div class="danger custom-block"><p class="custom-block-title">新手最容易犯的错</p><ol><li>在日志中打印密钥值（即使是 debug）</li><li>在 PR 评论或错误消息中暴露密钥</li><li>使用过于宽泛的权限</li><li>长期不轮换密钥</li></ol></div>`,7))])}const C=t(d,[["render",c]]);export{b as __pageData,C as default};
