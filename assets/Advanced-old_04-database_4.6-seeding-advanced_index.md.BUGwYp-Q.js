import{_ as l,C as h,c as p,o as i,a3 as a,b as e,w as n,a as k,G as E,a4 as r}from"./chunks/framework.CUcrqFol.js";const B=JSON.parse('{"title":"4.6 如何批量制造假数据——种子数据高级应用：多环境数据管理","description":"4.6 如何批量制造假数据——种子数据高级应用：多环境数据管理 认知重构 种子数据不只是\\"造假数据\\"——它是开发效率的倍增器，是测试质量的保障，是团队协作的基础。 种子数据的多重身份 子章节导航 | 章节 | 主题 | 核心问题 | |------|------|----------| | 4.6.1 | 幂等造数 |","frontmatter":{"title":"4.6 如何批量制造假数据——种子数据高级应用：多环境数据管理","typora-root-url":"../../public"},"headers":[],"relativePath":"Advanced-old/04-database/4.6-seeding-advanced/index.md","filePath":"Advanced-old/04-database/4.6-seeding-advanced/index.md","lastUpdated":1766168364000}'),d={name:"Advanced-old/04-database/4.6-seeding-advanced/index.md"};function g(c,s,y,F,o,A){const t=h("Mermaid");return i(),p("div",null,[s[1]||(s[1]=a('<h1 id="_4-6-如何批量制造假数据——种子数据高级应用-多环境数据管理" tabindex="-1">4.6 如何批量制造假数据——种子数据高级应用：多环境数据管理 <a class="header-anchor" href="#_4-6-如何批量制造假数据——种子数据高级应用-多环境数据管理" aria-label="Permalink to &quot;4.6 如何批量制造假数据——种子数据高级应用：多环境数据管理&quot;">​</a></h1><h3 id="认知重构" tabindex="-1">认知重构 <a class="header-anchor" href="#认知重构" aria-label="Permalink to &quot;认知重构&quot;">​</a></h3><p>种子数据不只是&quot;造假数据&quot;——它是开发效率的倍增器，是测试质量的保障，是团队协作的基础。</p><h3 id="种子数据的多重身份" tabindex="-1">种子数据的多重身份 <a class="header-anchor" href="#种子数据的多重身份" aria-label="Permalink to &quot;种子数据的多重身份&quot;">​</a></h3>',4)),(i(),e(r,null,{default:n(()=>[E(t,{id:"mermaid-12",class:"mermaid",graph:"graph%20TD%0A%20%20%20%20A%5B%22%E7%A7%8D%E5%AD%90%E6%95%B0%E6%8D%AE%22%5D%20--%3E%20B%5B%22%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%22%5D%0A%20%20%20%20A%20--%3E%20C%5B%22%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83%22%5D%0A%20%20%20%20A%20--%3E%20D%5B%22%E6%BC%94%E7%A4%BA%E7%8E%AF%E5%A2%83%22%5D%0A%20%20%20%20%0A%20%20%20%20B%20--%3E%20E%5B%22%E5%BF%AB%E9%80%9F%E5%90%AF%E5%8A%A8%E5%BC%80%E5%8F%91%22%5D%0A%20%20%20%20C%20--%3E%20F%5B%22%E4%BF%9D%E8%AF%81%E6%B5%8B%E8%AF%95%E5%8F%AF%E9%87%8D%E5%A4%8D%22%5D%0A%20%20%20%20D%20--%3E%20G%5B%22%E5%B1%95%E7%A4%BA%E4%BA%A7%E5%93%81%E5%8A%9F%E8%83%BD%22%5D%0A"})]),fallback:n(()=>[...s[0]||(s[0]=[k(" Loading... ",-1)])]),_:1})),s[2]||(s[2]=a(`<h3 id="子章节导航" tabindex="-1">子章节导航 <a class="header-anchor" href="#子章节导航" aria-label="Permalink to &quot;子章节导航&quot;">​</a></h3><table tabindex="0"><thead><tr><th>章节</th><th>主题</th><th>核心问题</th></tr></thead><tbody><tr><td>4.6.1</td><td>幂等造数</td><td>如何让种子脚本可以重复执行？</td></tr><tr><td>4.6.2</td><td>测试清理</td><td>测试前后的数据如何管理？</td></tr><tr><td>4.6.3</td><td>数据脱敏</td><td>如何安全使用生产数据做测试？</td></tr></tbody></table><h3 id="基础种子脚本回顾" tabindex="-1">基础种子脚本回顾 <a class="header-anchor" href="#基础种子脚本回顾" aria-label="Permalink to &quot;基础种子脚本回顾&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// prisma/seed.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { PrismaClient } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@prisma/client&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { faker } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@faker-js/faker&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> prisma</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PrismaClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 创建用户</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> prisma.user.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">upsert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    where: { email: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;admin@example.com&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    update: {},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    create: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      email: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;admin@example.com&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Admin&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      role: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ADMIN&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 批量创建测试数据</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> prisma.post.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      data: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        title: faker.lorem.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sentence</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        content: faker.lorem.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">paragraphs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        authorId: user.id</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(console.error)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">finally</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> prisma.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$disconnect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span></code></pre></div><h3 id="运行种子" tabindex="-1">运行种子 <a class="header-anchor" href="#运行种子" aria-label="Permalink to &quot;运行种子&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 执行种子脚本</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prisma</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> seed</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重置数据库并执行种子</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prisma</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> migrate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reset</span></span></code></pre></div><h3 id="本章小结" tabindex="-1">本章小结 <a class="header-anchor" href="#本章小结" aria-label="Permalink to &quot;本章小结&quot;">​</a></h3><ul><li>种子数据服务于开发、测试、演示多种场景</li><li>使用 <code>upsert</code> 实现幂等性</li><li>使用 Faker 生成真实感的测试数据</li><li>根据环境定制不同的数据策略</li></ul>`,8))])}const C=l(d,[["render",g]]);export{B as __pageData,C as default};
