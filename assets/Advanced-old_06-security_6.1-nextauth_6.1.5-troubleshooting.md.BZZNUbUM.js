import{_ as e,C as p,c as h,o as n,j as i,b as k,a3 as r,a,w as t,G as d,a4 as o}from"./chunks/framework.CUcrqFol.js";const C=JSON.parse('{"title":"6.1.5 登录失败了怎么办——常见问题：登录失败排查与解决方案","description":"6.1.5 登录失败了怎么办——常见问题排查 问题排查思路 常见错误及解决方案 NEXTAUTH_URL 配置错误 **错误表现**： **解决方案**： ::: warning 注意 URL 末尾不要加 生产环境必须使用 HTTPS Vercel 部署时会自动设置，但其他平台需要手动配置 ::: NEXTAUTH_S","frontmatter":{"title":"6.1.5 登录失败了怎么办——常见问题：登录失败排查与解决方案","typora-root-url":"../../public"},"headers":[],"relativePath":"Advanced-old/06-security/6.1-nextauth/6.1.5-troubleshooting.md","filePath":"Advanced-old/06-security/6.1-nextauth/6.1.5-troubleshooting.md","lastUpdated":1766168364000}'),E={name:"Advanced-old/06-security/6.1-nextauth/6.1.5-troubleshooting.md"};function c(g,s,y,u,F,A){const l=p("Mermaid");return n(),h("div",null,[s[1]||(s[1]=i("h1",{id:"_6-1-5-登录失败了怎么办——常见问题排查",tabindex:"-1"},[a("6.1.5 登录失败了怎么办——常见问题排查 "),i("a",{class:"header-anchor",href:"#_6-1-5-登录失败了怎么办——常见问题排查","aria-label":'Permalink to "6.1.5 登录失败了怎么办——常见问题排查"'},"​")],-1)),s[2]||(s[2]=i("h2",{id:"问题排查思路",tabindex:"-1"},[a("问题排查思路 "),i("a",{class:"header-anchor",href:"#问题排查思路","aria-label":'Permalink to "问题排查思路"'},"​")],-1)),(n(),k(o,null,{default:t(()=>[d(l,{id:"mermaid-6",class:"mermaid",graph:"flowchart%20TD%0A%20%20%20%20A%5B%22%E7%99%BB%E5%BD%95%E5%A4%B1%E8%B4%A5%22%5D%20--%3E%20B%7B%22%E6%9C%89%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF%E5%90%97%EF%BC%9F%22%7D%0A%20%20%20%20B%20--%3E%7C%E6%9C%89%7C%20C%5B%22%E6%9F%A5%E7%9C%8B%E5%85%B7%E4%BD%93%E9%94%99%E8%AF%AF%22%5D%0A%20%20%20%20B%20--%3E%7C%E6%97%A0%7C%20D%5B%22%E6%A3%80%E6%9F%A5%20Console%20%E5%92%8C%20Network%22%5D%0A%20%20%20%20%0A%20%20%20%20C%20--%3E%20E%5B%22%E5%AF%B9%E7%85%A7%E4%B8%8B%E6%96%B9%E9%94%99%E8%AF%AF%E5%88%97%E8%A1%A8%22%5D%0A%20%20%20%20D%20--%3E%20F%5B%22%E6%A3%80%E6%9F%A5%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94%22%5D%0A%20%20%20%20%0A%20%20%20%20F%20--%3E%20G%7B%22%E8%AF%B7%E6%B1%82%E5%8F%91%E5%87%BA%E4%BA%86%E5%90%97%EF%BC%9F%22%7D%0A%20%20%20%20G%20--%3E%7C%E5%90%A6%7C%20H%5B%22%E6%A3%80%E6%9F%A5%E6%8C%89%E9%92%AE%E4%BA%8B%E4%BB%B6%E7%BB%91%E5%AE%9A%22%5D%0A%20%20%20%20G%20--%3E%7C%E6%98%AF%7C%20I%5B%22%E6%A3%80%E6%9F%A5%E5%93%8D%E5%BA%94%E7%8A%B6%E6%80%81%E7%A0%81%22%5D%0A"})]),fallback:t(()=>[...s[0]||(s[0]=[a(" Loading... ",-1)])]),_:1})),s[3]||(s[3]=r(`<h2 id="常见错误及解决方案" tabindex="-1">常见错误及解决方案 <a class="header-anchor" href="#常见错误及解决方案" aria-label="Permalink to &quot;常见错误及解决方案&quot;">​</a></h2><h3 id="_1-nextauth-url-配置错误" tabindex="-1">1. NEXTAUTH_URL 配置错误 <a class="header-anchor" href="#_1-nextauth-url-配置错误" aria-label="Permalink to &quot;1. NEXTAUTH_URL 配置错误&quot;">​</a></h3><p><strong>错误表现</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Error: NEXTAUTH_URL environment variable is not set</span></span></code></pre></div><p><strong>解决方案</strong>：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># .env.local</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 开发环境</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NEXTAUTH_URL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http://localhost:3000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 生产环境</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NEXTAUTH_URL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">https://your-domain.com</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">注意</p><ul><li>URL 末尾不要加 <code>/</code></li><li>生产环境必须使用 HTTPS</li><li>Vercel 部署时会自动设置，但其他平台需要手动配置</li></ul></div><h3 id="_2-nextauth-secret-未设置" tabindex="-1">2. NEXTAUTH_SECRET 未设置 <a class="header-anchor" href="#_2-nextauth-secret-未设置" aria-label="Permalink to &quot;2. NEXTAUTH_SECRET 未设置&quot;">​</a></h3><p><strong>错误表现</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>[next-auth][error][NO_SECRET] </span></span>
<span class="line"><span>Please define a \`secret\` in production</span></span></code></pre></div><p><strong>解决方案</strong>：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 生成随机密钥</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rand</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -base64</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 32</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 添加到 .env.local</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NEXTAUTH_SECRET</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">生成的随机字符串</span></span></code></pre></div><h3 id="_3-回调地址不匹配" tabindex="-1">3. 回调地址不匹配 <a class="header-anchor" href="#_3-回调地址不匹配" aria-label="Permalink to &quot;3. 回调地址不匹配&quot;">​</a></h3><p><strong>错误表现</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Error 400: redirect_uri_mismatch</span></span></code></pre></div><p><strong>排查步骤</strong>：</p><ol><li>检查 OAuth 提供商后台配置的回调地址</li><li>确保格式完全正确：</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># Google</span></span>
<span class="line"><span>http://localhost:3000/api/auth/callback/google</span></span>
<span class="line"><span></span></span>
<span class="line"><span># GitHub  </span></span>
<span class="line"><span>http://localhost:3000/api/auth/callback/github</span></span></code></pre></div><ol start="3"><li>检查协议（http vs https）和端口号是否一致</li></ol><h3 id="_4-oauth-client-id-secret-错误" tabindex="-1">4. OAuth Client ID/Secret 错误 <a class="header-anchor" href="#_4-oauth-client-id-secret-错误" aria-label="Permalink to &quot;4. OAuth Client ID/Secret 错误&quot;">​</a></h3><p><strong>错误表现</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Error: invalid_client</span></span></code></pre></div><p><strong>排查步骤</strong>：</p><ol><li>确认环境变量名称正确</li><li>确认值没有多余的空格或换行</li><li>确认 Secret 没有过期（GitHub Secret 只显示一次）</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查环境变量是否正确加载</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">console.log(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;GOOGLE_CLIENT_ID:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> process.env.GOOGLE_CLIENT_ID</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h3 id="_5-sessionprovider-未配置" tabindex="-1">5. SessionProvider 未配置 <a class="header-anchor" href="#_5-sessionprovider-未配置" aria-label="Permalink to &quot;5. SessionProvider 未配置&quot;">​</a></h3><p><strong>错误表现</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Error: useSession must be wrapped in a SessionProvider</span></span></code></pre></div><p><strong>解决方案</strong>：</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// app/providers.tsx</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;use client&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { SessionProvider } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;next-auth/react&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Providers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">children</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">children</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> React</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ReactNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SessionProvider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;{children}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SessionProvider</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// app/layout.tsx</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { Providers } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;./providers&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RootLayout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">children</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">body</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Providers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;{children}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Providers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      &lt;/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">body</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">html</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_6-服务器组件中使用客户端-hook" tabindex="-1">6. 服务器组件中使用客户端 Hook <a class="header-anchor" href="#_6-服务器组件中使用客户端-hook" aria-label="Permalink to &quot;6. 服务器组件中使用客户端 Hook&quot;">​</a></h3><p><strong>错误表现</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Error: useSession only works in Client Components</span></span></code></pre></div><p><strong>解决方案</strong>：</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ❌ 错误：在 Server Component 中使用 useSession</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Page</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">session</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useSession</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 报错</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ✅ 正确：在 Server Component 中使用 getServerSession</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { getServerSession } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;next-auth&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Page</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> session</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getServerSession</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(authOptions)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ✅ 正确：在 Client Component 中使用 useSession</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;use client&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Page</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">session</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useSession</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_7-开发环境-https-问题" tabindex="-1">7. 开发环境 HTTPS 问题 <a class="header-anchor" href="#_7-开发环境-https-问题" aria-label="Permalink to &quot;7. 开发环境 HTTPS 问题&quot;">​</a></h3><p><strong>错误表现</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Cookies require Secure; SameSite=None</span></span></code></pre></div><p><strong>解决方案</strong>：</p><p>开发环境使用 HTTP 时，需要配置：</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// NextAuth 配置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cookies</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  sessionToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`next-auth.session-token\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    options</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      httpOnly</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      sameSite</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;lax&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      secure</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: process.env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NODE_ENV</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;production&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span></code></pre></div><h2 id="调试技巧" tabindex="-1">调试技巧 <a class="header-anchor" href="#调试技巧" aria-label="Permalink to &quot;调试技巧&quot;">​</a></h2><h3 id="启用-nextauth-调试模式" tabindex="-1">启用 NextAuth 调试模式 <a class="header-anchor" href="#启用-nextauth-调试模式" aria-label="Permalink to &quot;启用 NextAuth 调试模式&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> handler</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> NextAuth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  debug: process.env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NODE_ENV</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;development&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ...其他配置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><h3 id="检查-network-请求" tabindex="-1">检查 Network 请求 <a class="header-anchor" href="#检查-network-请求" aria-label="Permalink to &quot;检查 Network 请求&quot;">​</a></h3><ol><li>打开浏览器开发者工具 → Network 面板</li><li>过滤 <code>auth</code> 关键词</li><li>检查 <code>/api/auth/</code> 开头的请求</li><li>查看请求和响应的详细内容</li></ol><h3 id="常用调试端点" tabindex="-1">常用调试端点 <a class="header-anchor" href="#常用调试端点" aria-label="Permalink to &quot;常用调试端点&quot;">​</a></h3><table tabindex="0"><thead><tr><th>端点</th><th>用途</th></tr></thead><tbody><tr><td><code>/api/auth/providers</code></td><td>查看已配置的 Provider</td></tr><tr><td><code>/api/auth/session</code></td><td>查看当前 Session</td></tr><tr><td><code>/api/auth/csrf</code></td><td>获取 CSRF Token</td></tr></tbody></table><h2 id="生产环境检查清单" tabindex="-1">生产环境检查清单 <a class="header-anchor" href="#生产环境检查清单" aria-label="Permalink to &quot;生产环境检查清单&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">上线前必查</p><ol><li>[ ] <code>NEXTAUTH_URL</code> 设置为生产域名</li><li>[ ] <code>NEXTAUTH_SECRET</code> 使用强随机字符串</li><li>[ ] OAuth 提供商后台添加了生产环境回调地址</li><li>[ ] 环境变量已在部署平台正确配置</li><li>[ ] <code>debug: false</code> 或已移除 debug 选项</li><li>[ ] HTTPS 已正确配置</li></ol></div>`,50))])}const v=e(E,[["render",c]]);export{C as __pageData,v as default};
