import{_ as p,C as l,c as h,o as i,j as a,b as d,a3 as r,a as t,w as n,G as k,a4 as E}from"./chunks/framework.CUcrqFol.js";const b=JSON.parse('{"title":"9.3 给你的代码上保险——单元测试/集成测试：Jest + Test DB；seed 前置","description":"9.3 给你的代码上保险——单元测试/集成测试：Jest + Test DB；seed 前置 **自动化测试是你代码的保险单——每次改动都能自动验证是否破坏了已有功能。** 为什么需要自动化测试 本节技术栈 | 工具 | 用途 | 选择理由 | |------|------|---------| | Jest | 测试","frontmatter":{"title":"9.3 给你的代码上保险——单元测试/集成测试：Jest + Test DB；seed 前置","typora-root-url":"../../public"},"headers":[],"relativePath":"Advanced-old/09-testing/9.3-automated-tests/index.md","filePath":"Advanced-old/09-testing/9.3-automated-tests/index.md","lastUpdated":1766168364000}'),o={name:"Advanced-old/09-testing/9.3-automated-tests/index.md"};function c(g,s,F,B,y,A){const e=l("Mermaid");return i(),h("div",null,[s[1]||(s[1]=a("h1",{id:"_9-3-给你的代码上保险——单元测试-集成测试-jest-test-db-seed-前置",tabindex:"-1"},[t("9.3 给你的代码上保险——单元测试/集成测试：Jest + Test DB；seed 前置 "),a("a",{class:"header-anchor",href:"#_9-3-给你的代码上保险——单元测试-集成测试-jest-test-db-seed-前置","aria-label":'Permalink to "9.3 给你的代码上保险——单元测试/集成测试：Jest + Test DB；seed 前置"'},"​")],-1)),s[2]||(s[2]=a("p",null,[a("strong",null,"自动化测试是你代码的保险单——每次改动都能自动验证是否破坏了已有功能。")],-1)),s[3]||(s[3]=a("h2",{id:"为什么需要自动化测试",tabindex:"-1"},[t("为什么需要自动化测试 "),a("a",{class:"header-anchor",href:"#为什么需要自动化测试","aria-label":'Permalink to "为什么需要自动化测试"'},"​")],-1)),(i(),d(E,null,{default:n(()=>[k(e,{id:"mermaid-9",class:"mermaid",graph:"graph%20LR%0A%20%20%20%20subgraph%20%E6%B2%A1%E6%9C%89%E6%B5%8B%E8%AF%95%0A%20%20%20%20%20%20%20%20A1%5B%E4%BF%AE%E6%94%B9%E4%BB%A3%E7%A0%81%5D%20--%3E%20B1%5B%E6%89%8B%E5%8A%A8%E6%B5%8B%E8%AF%95%5D%0A%20%20%20%20%20%20%20%20B1%20--%3E%20C1%5B%E9%81%97%E6%BC%8F%E8%BE%B9%E7%95%8C%E6%83%85%E5%86%B5%5D%0A%20%20%20%20%20%20%20%20C1%20--%3E%20D1%5B%E4%B8%8A%E7%BA%BF%E5%90%8E%E5%8F%91%E7%8E%B0%20bug%5D%0A%20%20%20%20end%0A%20%20%20%20%0A%20%20%20%20subgraph%20%E6%9C%89%E6%B5%8B%E8%AF%95%0A%20%20%20%20%20%20%20%20A2%5B%E4%BF%AE%E6%94%B9%E4%BB%A3%E7%A0%81%5D%20--%3E%20B2%5B%E8%BF%90%E8%A1%8C%E6%B5%8B%E8%AF%95%5D%0A%20%20%20%20%20%20%20%20B2%20--%3E%20C2%7B%E6%B5%8B%E8%AF%95%E9%80%9A%E8%BF%87%3F%7D%0A%20%20%20%20%20%20%20%20C2%20--%3E%7C%E6%98%AF%7C%20D2%5B%E5%AE%89%E5%85%A8%E4%B8%8A%E7%BA%BF%5D%0A%20%20%20%20%20%20%20%20C2%20--%3E%7C%E5%90%A6%7C%20E2%5B%E7%AB%8B%E5%8D%B3%E5%8F%91%E7%8E%B0%E9%97%AE%E9%A2%98%5D%0A%20%20%20%20end%0A"})]),fallback:n(()=>[...s[0]||(s[0]=[t(" Loading... ",-1)])]),_:1})),s[4]||(s[4]=r(`<h2 id="本节技术栈" tabindex="-1">本节技术栈 <a class="header-anchor" href="#本节技术栈" aria-label="Permalink to &quot;本节技术栈&quot;">​</a></h2><table tabindex="0"><thead><tr><th>工具</th><th>用途</th><th>选择理由</th></tr></thead><tbody><tr><td>Jest</td><td>测试框架</td><td>零配置、快照测试、Mock 支持</td></tr><tr><td>ts-jest</td><td>TypeScript 支持</td><td>直接运行 TS 测试</td></tr><tr><td>@testing-library</td><td>React 测试</td><td>面向用户行为的测试</td></tr><tr><td>supertest</td><td>API 测试</td><td>简洁的 HTTP 断言</td></tr></tbody></table><h2 id="快速开始配置" tabindex="-1">快速开始配置 <a class="header-anchor" href="#快速开始配置" aria-label="Permalink to &quot;快速开始配置&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 安装依赖</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -D</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> jest</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ts-jest</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @types/jest</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 初始化配置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ts-jest</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> config:init</span></span></code></pre></div><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// jest.config.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { Config } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;jest&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  preset: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ts-jest&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  testEnvironment: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  roots: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&lt;rootDir&gt;/src&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&lt;rootDir&gt;/__tests__&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  testMatch: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;**/*.test.ts&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;**/*.spec.ts&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  setupFilesAfterEnv: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&lt;rootDir&gt;/jest.setup.ts&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  moduleNameMapper: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;^@/(.*)$&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&lt;rootDir&gt;/src/$1&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> config;</span></span></code></pre></div><h2 id="本节核心内容" tabindex="-1">本节核心内容 <a class="header-anchor" href="#本节核心内容" aria-label="Permalink to &quot;本节核心内容&quot;">​</a></h2><table tabindex="0"><thead><tr><th>小节</th><th>主题</th><th>解决的问题</th></tr></thead><tbody><tr><td>9.3.1</td><td>Jest 配置</td><td>如何配置测试框架和断言库</td></tr><tr><td>9.3.2</td><td>测试数据库</td><td>内存数据库 vs 真实数据库的选择</td></tr><tr><td>9.3.3</td><td>Seed 数据</td><td>如何准备测试用例所需的数据</td></tr><tr><td>9.3.4</td><td>Mock 策略</td><td>如何模拟外部依赖</td></tr></tbody></table><h2 id="测试文件组织" tabindex="-1">测试文件组织 <a class="header-anchor" href="#测试文件组织" aria-label="Permalink to &quot;测试文件组织&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>project/</span></span>
<span class="line"><span>├── src/</span></span>
<span class="line"><span>│   ├── services/</span></span>
<span class="line"><span>│   │   └── order.service.ts</span></span>
<span class="line"><span>│   └── utils/</span></span>
<span class="line"><span>│       └── price.ts</span></span>
<span class="line"><span>├── __tests__/</span></span>
<span class="line"><span>│   ├── services/</span></span>
<span class="line"><span>│   │   └── order.service.test.ts</span></span>
<span class="line"><span>│   ├── api/</span></span>
<span class="line"><span>│   │   └── orders.test.ts</span></span>
<span class="line"><span>│   └── helpers/</span></span>
<span class="line"><span>│       ├── factory.ts</span></span>
<span class="line"><span>│       └── cleanup.ts</span></span>
<span class="line"><span>├── jest.config.ts</span></span>
<span class="line"><span>└── jest.setup.ts</span></span></code></pre></div><h2 id="本节小结" tabindex="-1">本节小结 <a class="header-anchor" href="#本节小结" aria-label="Permalink to &quot;本节小结&quot;">​</a></h2><p>自动化测试是现代软件开发的基础设施。通过 Jest 和测试数据库的配合，可以实现从单元测试到集成测试的完整覆盖。关键是选择合适的工具、组织好测试代码、准备好测试数据。接下来的小节将详细介绍每个环节的具体实现。</p>`,11))])}const C=p(o,[["render",c]]);export{b as __pageData,C as default};
