import{_ as l,C as e,c as k,o as t,j as i,b as p,a3 as r,a,w as n,G as d,a4 as E}from"./chunks/framework.CUcrqFol.js";const D=JSON.parse('{"title":"6.2 你是谁与你能做什么——认证与授权安全实践","description":"6.2 你是谁与你能做什么——认证与授权安全 认知重构：认证与授权的本质区别 很多人把\\"认证\\"和\\"授权\\"混为一谈，但它们解决的是完全不同的问题： **认证（Authentication）**：验证\\"你是谁\\"——确认用户身份的真实性 **授权（Authorization）**：判断\\"你能做什么\\"——决定用户可以访问哪些资","frontmatter":{"title":"6.2 你是谁与你能做什么——认证与授权安全实践","typora-root-url":"../../public"},"headers":[],"relativePath":"Advanced-old/06-security/6.2-auth-security/index.md","filePath":"Advanced-old/06-security/6.2-auth-security/index.md","lastUpdated":1766168364000}'),o={name:"Advanced-old/06-security/6.2-auth-security/index.md"};function g(y,s,c,u,A,F){const h=e("Mermaid");return t(),k("div",null,[s[1]||(s[1]=i("h1",{id:"_6-2-你是谁与你能做什么——认证与授权安全",tabindex:"-1"},[a("6.2 你是谁与你能做什么——认证与授权安全 "),i("a",{class:"header-anchor",href:"#_6-2-你是谁与你能做什么——认证与授权安全","aria-label":'Permalink to "6.2 你是谁与你能做什么——认证与授权安全"'},"​")],-1)),s[2]||(s[2]=i("h2",{id:"认知重构-认证与授权的本质区别",tabindex:"-1"},[a("认知重构：认证与授权的本质区别 "),i("a",{class:"header-anchor",href:"#认知重构-认证与授权的本质区别","aria-label":'Permalink to "认知重构：认证与授权的本质区别"'},"​")],-1)),s[3]||(s[3]=i("p",null,'很多人把"认证"和"授权"混为一谈，但它们解决的是完全不同的问题：',-1)),s[4]||(s[4]=i("ul",null,[i("li",null,[i("strong",null,"认证（Authentication）"),a('：验证"你是谁"——确认用户身份的真实性')]),i("li",null,[i("strong",null,"授权（Authorization）"),a('：判断"你能做什么"——决定用户可以访问哪些资源')])],-1)),(t(),p(E,null,{default:n(()=>[d(h,{id:"mermaid-21",class:"mermaid",graph:"flowchart%20LR%0A%20%20%20%20User%5B%22%E7%94%A8%E6%88%B7%22%5D%20--%3E%7C1.%20%E6%8F%90%E4%BE%9B%E5%87%AD%E6%8D%AE%7C%20Auth%5B%22%E8%AE%A4%E8%AF%81%E7%B3%BB%E7%BB%9F%22%5D%0A%20%20%20%20Auth%20--%3E%7C2.%20%E9%AA%8C%E8%AF%81%E8%BA%AB%E4%BB%BD%7C%20AuthZ%5B%22%E6%8E%88%E6%9D%83%E7%B3%BB%E7%BB%9F%22%5D%0A%20%20%20%20AuthZ%20--%3E%7C3.%20%E6%A3%80%E6%9F%A5%E6%9D%83%E9%99%90%7C%20Resource%5B%22%E8%B5%84%E6%BA%90%22%5D%0A%20%20%20%20%0A%20%20%20%20Auth%20--%3E%7C%22%E4%BD%A0%E6%98%AF%E5%BC%A0%E4%B8%89%E5%90%97%EF%BC%9F%22%7C%20Check1%5B%22%E2%9C%85%20%E6%98%AF%22%5D%0A%20%20%20%20AuthZ%20--%3E%7C%22%E5%BC%A0%E4%B8%89%E8%83%BD%E7%9C%8B%E8%BF%99%E4%B8%AA%E5%90%97%EF%BC%9F%22%7C%20Check2%5B%22%E2%9C%85%20%E8%83%BD%22%5D%0A"})]),fallback:n(()=>[...s[0]||(s[0]=[a(" Loading... ",-1)])]),_:1})),s[5]||(s[5]=r(`<h2 id="为什么需要关注认证安全" tabindex="-1">为什么需要关注认证安全 <a class="header-anchor" href="#为什么需要关注认证安全" aria-label="Permalink to &quot;为什么需要关注认证安全&quot;">​</a></h2><p>认证是整个安全体系的第一道防线。如果认证被突破：</p><ul><li>攻击者可以冒充任意用户</li><li>所有后续的授权检查都失去意义</li><li>用户数据面临泄露风险</li></ul><h2 id="本节内容" tabindex="-1">本节内容 <a class="header-anchor" href="#本节内容" aria-label="Permalink to &quot;本节内容&quot;">​</a></h2><table tabindex="0"><thead><tr><th>小节</th><th>核心问题</th><th>你将学会</th></tr></thead><tbody><tr><td>6.2.1 JWT 安全</td><td>Token 被盗怎么办？</td><td>密钥管理、过期策略、刷新机制</td></tr><tr><td>6.2.2 Session 安全</td><td>Session 如何防劫持？</td><td>安全存储、传输加密、固定攻击防护</td></tr><tr><td>6.2.3 Cookie 安全</td><td>Cookie 怎么设置才安全？</td><td>HttpOnly/Secure/SameSite 属性详解</td></tr><tr><td>6.2.4 OAuth 2.0 安全</td><td>OAuth 流程有哪些风险？</td><td>授权码模式、PKCE、state 参数</td></tr><tr><td>6.2.5 多因素认证</td><td>密码不够安全怎么办？</td><td>TOTP、短信验证、硬件密钥</td></tr></tbody></table><h2 id="认证方案对比" tabindex="-1">认证方案对比 <a class="header-anchor" href="#认证方案对比" aria-label="Permalink to &quot;认证方案对比&quot;">​</a></h2><table tabindex="0"><thead><tr><th>方案</th><th>适用场景</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td><strong>Session</strong></td><td>传统 Web 应用</td><td>服务端可控、即时失效</td><td>需要存储、扩展性差</td></tr><tr><td><strong>JWT</strong></td><td>微服务、API</td><td>无状态、易扩展</td><td>无法即时撤销</td></tr><tr><td><strong>OAuth 2.0</strong></td><td>第三方登录</td><td>标准协议、用户体验好</td><td>实现复杂</td></tr></tbody></table><h2 id="安全设计原则" tabindex="-1">安全设计原则 <a class="header-anchor" href="#安全设计原则" aria-label="Permalink to &quot;安全设计原则&quot;">​</a></h2><h3 id="_1-纵深防御" tabindex="-1">1. 纵深防御 <a class="header-anchor" href="#_1-纵深防御" aria-label="Permalink to &quot;1. 纵深防御&quot;">​</a></h3><p>不要只依赖一层防护：</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 多层验证</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> protectedAction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 第一层：验证 Token 有效性</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> token</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> verifyToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 第二层：验证用户状态</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getUser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(token.userId)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (user.status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;active&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;账号已禁用&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 第三层：验证操作权限</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">user.permissions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">includes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;write&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;无权执行此操作&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_2-最小权限" tabindex="-1">2. 最小权限 <a class="header-anchor" href="#_2-最小权限" aria-label="Permalink to &quot;2. 最小权限&quot;">​</a></h3><p>只授予必要的权限：</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ❌ 过度授权</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> token</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> jwt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sign</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  userId, </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  role: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;admin&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 太宽泛</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  permissions: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;*&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 危险</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ✅ 最小权限</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> token</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> jwt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sign</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  userId,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  permissions: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;posts:read&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;posts:write&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 具体权限</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><h3 id="_3-安全默认" tabindex="-1">3. 安全默认 <a class="header-anchor" href="#_3-安全默认" aria-label="Permalink to &quot;3. 安全默认&quot;">​</a></h3><p>默认拒绝，显式允许：</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ❌ 默认允许</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> checkPermission</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">resource</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (resource.isRestricted) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hasAccess</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(resource)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 默认允许</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ✅ 默认拒绝</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> checkPermission</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">resource</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (resource.isPublic) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hasAccess</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(resource)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 默认需要验证</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="ai-协作提示" tabindex="-1">AI 协作提示 <a class="header-anchor" href="#ai-协作提示" aria-label="Permalink to &quot;AI 协作提示&quot;">​</a></h2><p>在让 AI 帮你实现认证功能时，务必强调：</p><ul><li>&quot;使用 HttpOnly 和 Secure 标志设置 Cookie&quot;</li><li>&quot;JWT 过期时间设置为较短时间，并实现 refresh token 机制&quot;</li><li>&quot;对敏感操作要求重新验证身份&quot;</li><li>&quot;实现登录失败次数限制&quot;</li></ul><div class="warning custom-block"><p class="custom-block-title">审查要点</p><p>AI 生成的认证代码，重点检查：</p><ol><li>密钥是否硬编码？</li><li>Token 过期时间是否合理？</li><li>错误信息是否泄露敏感信息？</li><li>是否有防暴力破解机制？</li></ol></div>`,21))])}const C=l(o,[["render",g]]);export{D as __pageData,C as default};
