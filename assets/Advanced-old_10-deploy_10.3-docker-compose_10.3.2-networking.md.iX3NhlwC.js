import{_ as d,C as r,c as o,o as l,j as a,b as e,a3 as p,a as i,w as n,G as h,a4 as k}from"./chunks/framework.CUcrqFol.js";const A=JSON.parse('{"title":"10.3.2 服务之间如何对话——网络与卷：服务间通信与数据共享","description":"10.3.2 服务之间如何对话——网络与卷：服务间通信与数据共享 容器间通信，用服务名就行。 Docker Compose 网络原理 Docker Compose 会自动为项目创建一个专属网络，所有服务都加入这个网络。在这个网络中，服务可以通过**服务名**相互访问。 服务间通信 使用服务名作为主机名 ::: warn","frontmatter":{"title":"10.3.2 服务之间如何对话——网络与卷：服务间通信与数据共享","typora-root-url":"../../public"},"headers":[],"relativePath":"Advanced-old/10-deploy/10.3-docker-compose/10.3.2-networking.md","filePath":"Advanced-old/10-deploy/10.3-docker-compose/10.3.2-networking.md","lastUpdated":1766168364000}'),E={name:"Advanced-old/10-deploy/10.3-docker-compose/10.3.2-networking.md"};function c(g,s,y,u,b,F){const t=r("Mermaid");return l(),o("div",null,[s[2]||(s[2]=a("h1",{id:"_10-3-2-服务之间如何对话——网络与卷-服务间通信与数据共享",tabindex:"-1"},[i("10.3.2 服务之间如何对话——网络与卷：服务间通信与数据共享 "),a("a",{class:"header-anchor",href:"#_10-3-2-服务之间如何对话——网络与卷-服务间通信与数据共享","aria-label":'Permalink to "10.3.2 服务之间如何对话——网络与卷：服务间通信与数据共享"'},"​")],-1)),s[3]||(s[3]=a("p",null,"容器间通信，用服务名就行。",-1)),s[4]||(s[4]=a("h2",{id:"docker-compose-网络原理",tabindex:"-1"},[i("Docker Compose 网络原理 "),a("a",{class:"header-anchor",href:"#docker-compose-网络原理","aria-label":'Permalink to "Docker Compose 网络原理"'},"​")],-1)),s[5]||(s[5]=a("p",null,[i("Docker Compose 会自动为项目创建一个专属网络，所有服务都加入这个网络。在这个网络中，服务可以通过"),a("strong",null,"服务名"),i("相互访问。")],-1)),(l(),e(k,null,{default:n(()=>[h(t,{id:"mermaid-12",class:"mermaid",graph:"flowchart%20TB%0A%20%20%20%20subgraph%20app_network%0A%20%20%20%20%20%20%20%20A%5Bfrontend%5D%20--%3E%7Capi%3A3001%7C%20B%5Bapi%5D%0A%20%20%20%20%20%20%20%20B%20--%3E%7Cpostgres%3A5432%7C%20C%5Bpostgres%5D%0A%20%20%20%20%20%20%20%20B%20--%3E%7Credis%3A6379%7C%20D%5Bredis%5D%0A%20%20%20%20end%0A%20%20%20%20E%5B%E5%A4%96%E9%83%A8%E8%AE%BF%E9%97%AE%5D%20--%3E%7Clocalhost%3A3000%7C%20A%0A"})]),fallback:n(()=>[...s[0]||(s[0]=[i(" Loading... ",-1)])]),_:1})),s[6]||(s[6]=p(`<h2 id="服务间通信" tabindex="-1">服务间通信 <a class="header-anchor" href="#服务间通信" aria-label="Permalink to &quot;服务间通信&quot;">​</a></h2><h3 id="使用服务名作为主机名" tabindex="-1">使用服务名作为主机名 <a class="header-anchor" href="#使用服务名作为主机名" aria-label="Permalink to &quot;使用服务名作为主机名&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  api</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # 使用服务名 postgres 而非 localhost</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">DATABASE_URL=postgresql://user:pass@postgres:5432/mydb</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # 使用服务名 redis</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">REDIS_URL=redis://redis:6379</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">常见错误</p><p>在容器内使用 <code>localhost</code> 是访问容器自己，而非其他服务。必须使用服务名！</p></div><h3 id="端口规则" tabindex="-1">端口规则 <a class="header-anchor" href="#端口规则" aria-label="Permalink to &quot;端口规则&quot;">​</a></h3><table tabindex="0"><thead><tr><th>场景</th><th>配置</th><th>说明</th></tr></thead><tbody><tr><td>容器间通信</td><td>直接使用容器端口</td><td><code>postgres:5432</code></td></tr><tr><td>外部访问</td><td>需要端口映射</td><td><code>ports: &quot;5432:5432&quot;</code></td></tr><tr><td>仅内部访问</td><td>使用 expose</td><td><code>expose: [&quot;5432&quot;]</code></td></tr></tbody></table><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  postgres</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">postgres:15</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 不映射端口，外部无法直接访问，更安全</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    expose</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;5432&quot;</span></span></code></pre></div><h2 id="自定义网络" tabindex="-1">自定义网络 <a class="header-anchor" href="#自定义网络" aria-label="Permalink to &quot;自定义网络&quot;">​</a></h2><h3 id="多网络隔离" tabindex="-1">多网络隔离 <a class="header-anchor" href="#多网络隔离" aria-label="Permalink to &quot;多网络隔离&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  frontend</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    networks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">frontend-network</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  api</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    networks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">frontend-network</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">backend-network</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  postgres</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    networks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">backend-network</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 数据库不暴露给前端</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">networks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  frontend-network</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  backend-network</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span></code></pre></div>`,10)),(l(),e(k,null,{default:n(()=>[h(t,{id:"mermaid-86",class:"mermaid",graph:"flowchart%20LR%0A%20%20%20%20subgraph%20frontend-network%0A%20%20%20%20%20%20%20%20A%5Bfrontend%5D%20--%3E%20B%5Bapi%5D%0A%20%20%20%20end%0A%20%20%20%20subgraph%20backend-network%0A%20%20%20%20%20%20%20%20B%20--%3E%20C%5Bpostgres%5D%0A%20%20%20%20end%0A"})]),fallback:n(()=>[...s[1]||(s[1]=[i(" Loading... ",-1)])]),_:1})),s[7]||(s[7]=p(`<h3 id="网络别名" tabindex="-1">网络别名 <a class="header-anchor" href="#网络别名" aria-label="Permalink to &quot;网络别名&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  postgres</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    networks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        aliases</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">db</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">database</span></span></code></pre></div><p>现在可以用 <code>postgres</code>、<code>db</code>、<code>database</code> 三个名称访问同一服务。</p><h2 id="数据卷详解" tabindex="-1">数据卷详解 <a class="header-anchor" href="#数据卷详解" aria-label="Permalink to &quot;数据卷详解&quot;">​</a></h2><h3 id="卷的类型" tabindex="-1">卷的类型 <a class="header-anchor" href="#卷的类型" aria-label="Permalink to &quot;卷的类型&quot;">​</a></h3><table tabindex="0"><thead><tr><th>类型</th><th>语法</th><th>特点</th></tr></thead><tbody><tr><td>命名卷</td><td><code>volume-name:/path</code></td><td>Docker 管理，持久化</td></tr><tr><td>绑定挂载</td><td><code>./host/path:/container/path</code></td><td>直接映射主机目录</td></tr><tr><td>匿名卷</td><td><code>/path</code></td><td>临时，容器删除即丢失</td></tr></tbody></table><h3 id="命名卷-推荐用于数据持久化" tabindex="-1">命名卷（推荐用于数据持久化） <a class="header-anchor" href="#命名卷-推荐用于数据持久化" aria-label="Permalink to &quot;命名卷（推荐用于数据持久化）&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  postgres</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">postgres-data:/var/lib/postgresql/data</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  postgres-data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 声明命名卷</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    driver</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">local</span></span></code></pre></div><h3 id="绑定挂载-开发时常用" tabindex="-1">绑定挂载（开发时常用） <a class="header-anchor" href="#绑定挂载-开发时常用" aria-label="Permalink to &quot;绑定挂载（开发时常用）&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  api</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # 将本地代码挂载到容器，实现热重载</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./api:/app</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # 排除 node_modules（使用匿名卷）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/app/node_modules</span></span></code></pre></div><h3 id="只读挂载" tabindex="-1">只读挂载 <a class="header-anchor" href="#只读挂载" aria-label="Permalink to &quot;只读挂载&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  nginx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./nginx.conf:/etc/nginx/nginx.conf:ro</span></span></code></pre></div><h2 id="数据共享场景" tabindex="-1">数据共享场景 <a class="header-anchor" href="#数据共享场景" aria-label="Permalink to &quot;数据共享场景&quot;">​</a></h2><h3 id="场景一-多服务共享数据" tabindex="-1">场景一：多服务共享数据 <a class="header-anchor" href="#场景一-多服务共享数据" aria-label="Permalink to &quot;场景一：多服务共享数据&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  api</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">shared-uploads:/app/uploads</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  worker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">shared-uploads:/app/uploads</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  shared-uploads</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span></code></pre></div><h3 id="场景二-初始化脚本" tabindex="-1">场景二：初始化脚本 <a class="header-anchor" href="#场景二-初始化脚本" aria-label="Permalink to &quot;场景二：初始化脚本&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  postgres</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./init.sql:/docker-entrypoint-initdb.d/init.sql:ro</span></span></code></pre></div><p>PostgreSQL 会在首次启动时自动执行 <code>/docker-entrypoint-initdb.d/</code> 下的脚本。</p><h2 id="查看网络和卷" tabindex="-1">查看网络和卷 <a class="header-anchor" href="#查看网络和卷" aria-label="Permalink to &quot;查看网络和卷&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看项目网络</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> network</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ls</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> myproject</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看网络详情</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> network</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> inspect</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> myproject_default</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看卷</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> volume</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ls</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看卷详情</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> volume</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> inspect</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> myproject_postgres-data</span></span></code></pre></div><h2 id="清理资源" tabindex="-1">清理资源 <a class="header-anchor" href="#清理资源" aria-label="Permalink to &quot;清理资源&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 停止并删除容器，但保留卷</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> down</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 停止并删除容器和卷（危险！数据会丢失）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> down</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 删除未使用的卷</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> volume</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prune</span></span></code></pre></div><div class="danger custom-block"><p class="custom-block-title">数据安全</p><p><code>docker compose down -v</code> 会删除所有数据卷，生产环境慎用！</p></div><h2 id="最佳实践" tabindex="-1">最佳实践 <a class="header-anchor" href="#最佳实践" aria-label="Permalink to &quot;最佳实践&quot;">​</a></h2><ol><li><strong>生产环境不映射数据库端口</strong>：避免外部直接访问</li><li><strong>使用命名卷持久化数据</strong>：比绑定挂载更可靠</li><li><strong>敏感服务使用独立网络</strong>：隔离前后端</li><li><strong>定期备份数据卷</strong>：使用 <code>docker run</code> 挂载卷并执行备份</li></ol>`,25))])}const D=d(E,[["render",c]]);export{A as __pageData,D as default};
