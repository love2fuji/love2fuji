import{_ as e,C as l,c as p,o as i,a3 as a,b as h,w as t,a as k,G as d,a4 as r}from"./chunks/framework.CUcrqFol.js";const b=JSON.parse('{"title":"4.4.5 迁移与类型生成：db:generate / db:migrate","description":"4.4.5 迁移与类型生成：db:generate / db:migrate 一句话破题 迁移是数据库的\\"版本控制\\"——它记录了每次结构变更，让你能够安全地演进数据库。 迁移工作流程 开发环境迁移 **创建并应用迁移**： 这个命令会： 检测 Schema 变更 生成 SQL 迁移文件 应用迁移到数据库 重新生成 Pr","frontmatter":{"title":"4.4.5 迁移与类型生成：db:generate / db:migrate","typora-root-url":"../../public"},"headers":[],"relativePath":"Advanced-old/04-database/4.4-prisma/4.4.5-migrate.md","filePath":"Advanced-old/04-database/4.4-prisma/4.4.5-migrate.md","lastUpdated":1766168364000}'),o={name:"Advanced-old/04-database/4.4-prisma/4.4.5-migrate.md"};function g(c,s,F,E,y,m){const n=l("Mermaid");return i(),p("div",null,[s[1]||(s[1]=a('<h1 id="_4-4-5-迁移与类型生成-db-generate-db-migrate" tabindex="-1">4.4.5 迁移与类型生成：db:generate / db:migrate <a class="header-anchor" href="#_4-4-5-迁移与类型生成-db-generate-db-migrate" aria-label="Permalink to &quot;4.4.5 迁移与类型生成：db:generate / db:migrate&quot;">​</a></h1><h3 id="一句话破题" tabindex="-1">一句话破题 <a class="header-anchor" href="#一句话破题" aria-label="Permalink to &quot;一句话破题&quot;">​</a></h3><p>迁移是数据库的&quot;版本控制&quot;——它记录了每次结构变更，让你能够安全地演进数据库。</p><h3 id="迁移工作流程" tabindex="-1">迁移工作流程 <a class="header-anchor" href="#迁移工作流程" aria-label="Permalink to &quot;迁移工作流程&quot;">​</a></h3>',4)),(i(),h(r,null,{default:t(()=>[d(n,{id:"mermaid-12",class:"mermaid",graph:"graph%20LR%0A%20%20%20%20A%5B%22%E4%BF%AE%E6%94%B9%20Schema%22%5D%20--%3E%20B%5B%22%E7%94%9F%E6%88%90%E8%BF%81%E7%A7%BB%E6%96%87%E4%BB%B6%22%5D%0A%20%20%20%20B%20--%3E%20C%5B%22%E5%BA%94%E7%94%A8%E8%BF%81%E7%A7%BB%22%5D%0A%20%20%20%20C%20--%3E%20D%5B%22%E7%94%9F%E6%88%90%20Client%22%5D%0A%20%20%20%20%0A%20%20%20%20B1%5B%22prisma%20migrate%20dev%22%5D%20--%3E%20B%0A%20%20%20%20B1%20--%3E%20C%0A%20%20%20%20B1%20--%3E%20D%0A"})]),fallback:t(()=>[...s[0]||(s[0]=[k(" Loading... ",-1)])]),_:1})),s[2]||(s[2]=a(`<h3 id="开发环境迁移" tabindex="-1">开发环境迁移 <a class="header-anchor" href="#开发环境迁移" aria-label="Permalink to &quot;开发环境迁移&quot;">​</a></h3><p><strong>创建并应用迁移</strong>：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prisma</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> migrate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> init</span></span></code></pre></div><p>这个命令会：</p><ol><li>检测 Schema 变更</li><li>生成 SQL 迁移文件</li><li>应用迁移到数据库</li><li>重新生成 Prisma Client</li></ol><p><strong>迁移文件结构</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>prisma/</span></span>
<span class="line"><span>├── migrations/</span></span>
<span class="line"><span>│   ├── 20240101120000_init/</span></span>
<span class="line"><span>│   │   └── migration.sql</span></span>
<span class="line"><span>│   ├── 20240102130000_add_posts/</span></span>
<span class="line"><span>│   │   └── migration.sql</span></span>
<span class="line"><span>│   └── migration_lock.toml</span></span>
<span class="line"><span>└── schema.prisma</span></span></code></pre></div><p><strong>查看迁移文件内容</strong>：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 20240101120000_init/migration.sql</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&quot; (</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;id&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TEXT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;email&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TEXT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;name&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TEXT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;createdAt&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TIMESTAMP</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DEFAULT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CURRENT_TIMESTAMP,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    CONSTRAINT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;User_pkey&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> PRIMARY KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> UNIQUE INDEX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">User_email_key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&quot; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;User&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;email&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h3 id="生成-prisma-client" tabindex="-1">生成 Prisma Client <a class="header-anchor" href="#生成-prisma-client" aria-label="Permalink to &quot;生成 Prisma Client&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prisma</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> generate</span></span></code></pre></div><p><strong>何时需要运行</strong>：</p><ul><li>修改 schema.prisma 后</li><li>安装依赖后（配合 <code>postinstall</code> 脚本）</li><li>CI/CD 构建时</li></ul><p><strong>自动生成配置</strong>：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// package.json</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;scripts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;postinstall&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;prisma generate&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="db-push-vs-migrate" tabindex="-1">db push vs migrate <a class="header-anchor" href="#db-push-vs-migrate" aria-label="Permalink to &quot;db push vs migrate&quot;">​</a></h3><table tabindex="0"><thead><tr><th>命令</th><th>用途</th><th>场景</th></tr></thead><tbody><tr><td><code>prisma db push</code></td><td>直接同步 Schema 到数据库</td><td>原型开发、快速迭代</td></tr><tr><td><code>prisma migrate dev</code></td><td>生成迁移文件再应用</td><td>正式开发、团队协作</td></tr></tbody></table><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 原型阶段：快速迭代，不生成迁移文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prisma</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 正式开发：生成迁移文件，记录变更历史</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prisma</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> migrate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add_user_role</span></span></code></pre></div><h3 id="生产环境迁移" tabindex="-1">生产环境迁移 <a class="header-anchor" href="#生产环境迁移" aria-label="Permalink to &quot;生产环境迁移&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 只应用已有的迁移文件，不生成新的</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prisma</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> migrate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deploy</span></span></code></pre></div><p><strong>CI/CD 配置示例</strong>：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># .github/workflows/deploy.yml</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Apply migrations</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">npx prisma migrate deploy</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    DATABASE_URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ secrets.DATABASE_URL }}</span></span></code></pre></div><h3 id="迁移状态管理" tabindex="-1">迁移状态管理 <a class="header-anchor" href="#迁移状态管理" aria-label="Permalink to &quot;迁移状态管理&quot;">​</a></h3><p><strong>查看迁移状态</strong>：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prisma</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> migrate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span></span></code></pre></div><p><strong>重置数据库</strong>（开发环境）：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 删除所有数据，重新应用所有迁移</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prisma</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> migrate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reset</span></span></code></pre></div><div class="danger custom-block"><p class="custom-block-title">警告</p><p><code>migrate reset</code> 会删除所有数据！只在开发环境使用。</p></div><h3 id="处理迁移冲突" tabindex="-1">处理迁移冲突 <a class="header-anchor" href="#处理迁移冲突" aria-label="Permalink to &quot;处理迁移冲突&quot;">​</a></h3><p><strong>场景</strong>：团队成员同时修改 Schema</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. 拉取最新代码</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. 应用他人的迁移</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prisma</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> migrate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. 如有冲突，手动解决后重新迁移</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prisma</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> migrate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> resolve_conflict</span></span></code></pre></div><h3 id="自定义迁移" tabindex="-1">自定义迁移 <a class="header-anchor" href="#自定义迁移" aria-label="Permalink to &quot;自定义迁移&quot;">​</a></h3><p><strong>创建空迁移</strong>（用于手动编写 SQL）：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prisma</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> migrate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --create-only</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> custom_migration</span></span></code></pre></div><p>然后编辑生成的 <code>migration.sql</code> 文件：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 添加自定义 SQL</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;User&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ADD</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> CONSTRAINT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;email_format&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CHECK</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (email ~</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p>再应用：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prisma</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> migrate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span></span></code></pre></div><h3 id="常用命令速查" tabindex="-1">常用命令速查 <a class="header-anchor" href="#常用命令速查" aria-label="Permalink to &quot;常用命令速查&quot;">​</a></h3><table tabindex="0"><thead><tr><th>命令</th><th>作用</th></tr></thead><tbody><tr><td><code>prisma migrate dev</code></td><td>开发环境：生成并应用迁移</td></tr><tr><td><code>prisma migrate deploy</code></td><td>生产环境：应用迁移</td></tr><tr><td><code>prisma migrate reset</code></td><td>重置数据库</td></tr><tr><td><code>prisma migrate status</code></td><td>查看迁移状态</td></tr><tr><td><code>prisma db push</code></td><td>直接同步 Schema</td></tr><tr><td><code>prisma generate</code></td><td>生成 Prisma Client</td></tr><tr><td><code>prisma db pull</code></td><td>从数据库生成 Schema</td></tr></tbody></table><h3 id="避坑指南" tabindex="-1">避坑指南 <a class="header-anchor" href="#避坑指南" aria-label="Permalink to &quot;避坑指南&quot;">​</a></h3><ol><li><p><strong>不要手动修改已应用的迁移文件</strong>：会导致状态不一致</p></li><li><p><strong>迁移文件要提交到 Git</strong>：确保团队成员的数据库结构一致</p></li><li><p><strong>生产环境只用 <code>migrate deploy</code></strong>：不要在生产环境运行 <code>migrate dev</code></p></li><li><p><strong>大型迁移分批执行</strong>：避免锁表时间过长</p></li></ol><h3 id="本节小结" tabindex="-1">本节小结 <a class="header-anchor" href="#本节小结" aria-label="Permalink to &quot;本节小结&quot;">​</a></h3><ul><li><code>prisma migrate dev</code> 用于开发环境迁移</li><li><code>prisma migrate deploy</code> 用于生产环境部署</li><li>迁移文件需要提交到版本控制</li><li><code>prisma generate</code> 生成类型安全的 Client</li></ul>`,44))])}const C=e(o,[["render",g]]);export{b as __pageData,C as default};
