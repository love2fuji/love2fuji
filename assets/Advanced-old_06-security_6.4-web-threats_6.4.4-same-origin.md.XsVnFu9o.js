import{_ as i,c as a,o as t,a3 as h}from"./chunks/framework.CUcrqFol.js";const E=JSON.parse('{"title":"6.4.4 同源策略：浏览器安全基础","description":"6.4.4 同源策略：浏览器安全基础 一句话破题 同源策略是浏览器的默认安全机制：**只有来自同一个\\"源\\"的脚本，才能读取对方的数据**。它是 Web 安全的第一道防线。 核心价值 理解同源策略能让你： 明白为什么需要 CORS 理解前后端分离时的跨域问题 知道哪些操作会被浏览器阻止 什么是\\"同源\\"？ 一个 URL 由","frontmatter":{"title":"6.4.4 同源策略：浏览器安全基础","typora-root-url":"../../public"},"headers":[],"relativePath":"Advanced-old/06-security/6.4-web-threats/6.4.4-same-origin.md","filePath":"Advanced-old/06-security/6.4-web-threats/6.4.4-same-origin.md","lastUpdated":1766168364000}'),n={name:"Advanced-old/06-security/6.4-web-threats/6.4.4-same-origin.md"};function l(e,s,p,k,r,d){return t(),a("div",null,[...s[0]||(s[0]=[h(`<h1 id="_6-4-4-同源策略-浏览器安全基础" tabindex="-1">6.4.4 同源策略：浏览器安全基础 <a class="header-anchor" href="#_6-4-4-同源策略-浏览器安全基础" aria-label="Permalink to &quot;6.4.4 同源策略：浏览器安全基础&quot;">​</a></h1><h2 id="一句话破题" tabindex="-1">一句话破题 <a class="header-anchor" href="#一句话破题" aria-label="Permalink to &quot;一句话破题&quot;">​</a></h2><p>同源策略是浏览器的默认安全机制：<strong>只有来自同一个&quot;源&quot;的脚本，才能读取对方的数据</strong>。它是 Web 安全的第一道防线。</p><h2 id="核心价值" tabindex="-1">核心价值 <a class="header-anchor" href="#核心价值" aria-label="Permalink to &quot;核心价值&quot;">​</a></h2><p>理解同源策略能让你：</p><ul><li>明白为什么需要 CORS</li><li>理解前后端分离时的跨域问题</li><li>知道哪些操作会被浏览器阻止</li></ul><h2 id="什么是-同源" tabindex="-1">什么是&quot;同源&quot;？ <a class="header-anchor" href="#什么是-同源" aria-label="Permalink to &quot;什么是&quot;同源&quot;？&quot;">​</a></h2><p>一个 URL 由协议、域名、端口组成。只有三者完全相同，才算&quot;同源&quot;。</p><table tabindex="0"><thead><tr><th>URL A</th><th>URL B</th><th>是否同源</th><th>原因</th></tr></thead><tbody><tr><td><code>https://example.com</code></td><td><code>https://example.com/page</code></td><td>✅ 同源</td><td>路径不影响</td></tr><tr><td><code>https://example.com</code></td><td><code>http://example.com</code></td><td>❌ 不同源</td><td>协议不同</td></tr><tr><td><code>https://example.com</code></td><td><code>https://api.example.com</code></td><td>❌ 不同源</td><td>域名不同</td></tr><tr><td><code>https://example.com</code></td><td><code>https://example.com:8080</code></td><td>❌ 不同源</td><td>端口不同</td></tr></tbody></table><h2 id="同源策略限制什么" tabindex="-1">同源策略限制什么？ <a class="header-anchor" href="#同源策略限制什么" aria-label="Permalink to &quot;同源策略限制什么？&quot;">​</a></h2><h3 id="被限制的操作" tabindex="-1">被限制的操作 <a class="header-anchor" href="#被限制的操作" aria-label="Permalink to &quot;被限制的操作&quot;">​</a></h3><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ❌ 不能读取跨域请求的响应</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;https://other-site.com/api&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 被阻止</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ❌ 不能读取跨域 iframe 的内容</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> iframe</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">querySelector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;iframe&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">iframe.contentDocument  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 被阻止</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ❌ 不能读取跨域页面的 Cookie/Storage</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;other-site-data&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 只能读本站的</span></span></code></pre></div><h3 id="不被限制的操作" tabindex="-1">不被限制的操作 <a class="header-anchor" href="#不被限制的操作" aria-label="Permalink to &quot;不被限制的操作&quot;">​</a></h3><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&lt;!-- ✅ 可以加载跨域资源 --&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">img</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> src</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://other-site.com/image.png&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> src</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://cdn.example.com/lib.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">link</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> href</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://fonts.googleapis.com/css&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;stylesheet&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&lt;!-- ✅ 可以发送跨域请求（但不能读响应） --&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">form</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://other-site.com/submit&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> method</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;POST&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><h2 id="绕过同源策略的合法方式" tabindex="-1">绕过同源策略的合法方式 <a class="header-anchor" href="#绕过同源策略的合法方式" aria-label="Permalink to &quot;绕过同源策略的合法方式&quot;">​</a></h2><h3 id="_1-cors-推荐" tabindex="-1">1. CORS（推荐） <a class="header-anchor" href="#_1-cors-推荐" aria-label="Permalink to &quot;1. CORS（推荐）&quot;">​</a></h3><p>服务端返回允许跨域的响应头：</p><div class="language-http vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Access-Control-Allow-Origin</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://your-site.com</span></span></code></pre></div><h3 id="_2-代理" tabindex="-1">2. 代理 <a class="header-anchor" href="#_2-代理" aria-label="Permalink to &quot;2. 代理&quot;">​</a></h3><p>通过同源的服务端转发请求：</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 前端请求同源 API</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/api/proxy?url=https://other-site.com/data&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 服务端代理转发</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request.url).searchParams.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;url&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Response.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_3-jsonp-过时" tabindex="-1">3. JSONP（过时） <a class="header-anchor" href="#_3-jsonp-过时" aria-label="Permalink to &quot;3. JSONP（过时）&quot;">​</a></h3><p>利用 <code>&lt;script&gt;</code> 标签不受同源限制的特性，现已不推荐使用。</p><h2 id="避坑指南" tabindex="-1">避坑指南 <a class="header-anchor" href="#避坑指南" aria-label="Permalink to &quot;避坑指南&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">开发时的常见困惑</p><p><strong>问题</strong>：本地开发时 <code>localhost:3000</code> 调用 <code>localhost:8000</code> 的 API 被阻止</p><p><strong>原因</strong>：端口不同 = 不同源</p><p><strong>解决</strong>：</p><ol><li>后端配置 CORS 允许 <code>localhost:3000</code></li><li>或使用 Next.js 的 API Routes 作为代理</li></ol></div>`,25)])])}const c=i(n,[["render",l]]);export{E as __pageData,c as default};
